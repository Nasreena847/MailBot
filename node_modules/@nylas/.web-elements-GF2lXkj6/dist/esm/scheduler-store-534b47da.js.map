{"file":"scheduler-store-534b47da.js","mappings":"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","names":["i18next"],"sources":["src/connector/nylas-scheduler-connector/errors/index.ts","src/connector/shared/api/scheduler.ts","src/stores/scheduler-store.ts"],"sourcesContent":["export enum ErrorCategory {\n  Component = 'component',\n  Api = 'api',\n  Auth = 'auth',\n}\n\nexport interface ErrorDetails {\n  title: string;\n  message: string;\n  category: ErrorCategory;\n}\n\nexport enum ComponentErrorType {\n  endtime_not_in_future = 'endtime_not_in_future',\n  no_booking_info = 'no_booking_info',\n  no_timeslot_selected = 'no_timeslot_selected',\n  no_timezone_selected = 'no_timezone_selected',\n  no_booking_id = 'no_booking_id',\n  no_salt = 'no_salt',\n  invalid_start_time = 'invalid_start_time',\n  invalid_end_time = 'invalid_end_time',\n  invalid_timezone = 'invalid_timezone',\n}\n\nexport enum APIErrorType {\n  invalid_session = 'invalid_session',\n  general_error = 'general_error',\n  internal_error = 'internal_error',\n  invalid_request_error = 'invalid_request_error',\n  timeslot_not_available = 'timeslot_not_available',\n  provider_error = 'provider_error',\n  not_found_error = 'not_found_error',\n}\n\nexport class Errors {\n  component = (_title: string): Record<ComponentErrorType, (message?: string) => ErrorDetails> => {\n    const category = ErrorCategory.Component;\n    const title = `${_title} Error`;\n    return {\n      endtime_not_in_future: (message: string = '\"endtime\" can not be in the future') => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      no_booking_info: (message: string = 'No booking info provided') => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      no_timeslot_selected: (message: string = 'No timeslot selected') => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      no_timezone_selected: (message: string = 'No timezone selected') => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      no_booking_id: (message: string = 'No booking id provided') => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      no_salt: (message: string = 'No salt provided') => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      invalid_start_time: (message: string = 'Invalid start time') => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      invalid_end_time: (message: string = 'Invalid end time') => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      invalid_timezone: (message: string = 'Invalid timezone') => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n    };\n  };\n\n  api = (_title: string): Record<APIErrorType, (message: string) => ErrorDetails> => {\n    const category = ErrorCategory.Api;\n    const title = `${_title} Error`;\n\n    return {\n      invalid_session: (message: string) => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      general_error: (message: string) => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      internal_error: (message: string) => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      invalid_request_error: (message: string) => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      timeslot_not_available: (message: string) => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      provider_error: (message: string) => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n      not_found_error: (message: string) => {\n        return {\n          title,\n          message,\n          category,\n        };\n      },\n    };\n  };\n}\n","import { AvailabilityResponse, NylasEvent, UISettingsResponse } from '@/common/types';\nimport { NylasSchedulerStoreType } from '../../../components';\nimport type { NylasErrorResponse, NylasResponse, NylasSchedulerBookingData, NylasSchedulerResponse, Timeslot } from '@nylas/core';\nimport { APIErrorType, Errors } from '@/connector/nylas-scheduler-connector/errors';\nimport { addDaysToCurrentDate } from '@/utils/utils';\nimport i18next from '@/utils/i18n';\n\ntype NylasSchedulerAPIConnectorOptions = {\n  schedulerAPIURL: string;\n  schedulerStore: NylasSchedulerStoreType;\n  sessionId?: string;\n  configId?: string;\n  slug?: string;\n  clientId?: string;\n};\n\n/**\n * NylaSchedulerConnector\n * This class is used to make API requests to the scheduler.\n */\nexport class NylaSchedulerAPIConnector {\n  private schedulerStore: NylasSchedulerStoreType;\n  private schedulerAPIURL: string;\n  private sessionId: string | undefined;\n  private configId: string | undefined;\n  private slug: string | undefined;\n  private clientId: string | undefined;\n  private errors = new Errors();\n\n  constructor({ schedulerAPIURL, schedulerStore, sessionId, configId, slug, clientId }: NylasSchedulerAPIConnectorOptions) {\n    this.schedulerStore = schedulerStore;\n    this.schedulerAPIURL = schedulerAPIURL;\n    this.sessionId = sessionId;\n    this.configId = configId;\n    this.slug = slug;\n    this.clientId = clientId;\n  }\n\n  private getHeaders() {\n    return this.sessionId\n      ? {\n          Authorization: `Bearer ${this.sessionId}`,\n        }\n      : {};\n  }\n\n  /**\n   * Makes an API request to the scheduler.\n   * @param path The path to the API endpoint.\n   * @param method The HTTP method.\n   * @param body The request body (if any).\n   * @returns {Promise<T>}\n   */\n  public async makeAPIRequest<T>(path: string, method: string, body: string | undefined, headers = {}): Promise<NylasResponse<T>> {\n    try {\n      const schedulerURL = new URL(this.schedulerAPIURL);\n      schedulerURL.pathname = path;\n      const response = await fetch(decodeURIComponent(schedulerURL.toString()), {\n        method,\n        headers: {\n          'Content-Type': 'application/json',\n          'Origin': window.location.origin,\n          ...headers,\n        },\n        body,\n      });\n      // The server returns a json object for errors: eg.\n      // {\n      //     \"request_id\": \"<request_id>\",\n      //     \"error\": {\n      //         \"type\": \"not_found_error\",\n      //         \"message\": \"Session not found\"\n      //     }\n      // }\n      const data = await response.json();\n      return data as NylasResponse<T>;\n    } catch (error: any) {\n      // NOTE: current server implementation doesn't return a JSON object for errors on some endpoints\n      // handle this case by returning the error response as a string to be handled downstream\n      return {\n        error: {\n          message: error.message,\n          title: 'API request failed',\n          type: 'api',\n        },\n      } as NylasErrorResponse;\n    }\n  }\n\n  private getErrorMessage(error: NylasErrorResponse['error']) {\n    let errorMessage = error?.message || error?.title || 'Something went wrong';\n    if (error?.type === 'provider_error') {\n      errorMessage = error?.provider_error?.error?.message || error?.provider_error?.error?.title || 'Something went wrong';\n    }\n    return errorMessage;\n  }\n\n  public setConfigId(configId: string) {\n    this.configId = configId;\n  }\n\n  /**\n   * Selects a date in the scheduler.\n   */\n  public selectDate(date: Date) {\n    this.schedulerStore.set('selectedDate', date);\n    this.schedulerStore.set('selectedTimeslot', null);\n  }\n\n  /**\n   * Selects a time in the scheduler.\n   */\n  public selectTime(time: Timeslot) {\n    this.schedulerStore.set('selectedTimeslot', time);\n  }\n\n  /**\n   * Sets the timezone in the scheduler.\n   */\n  public selectTimezone(timezone: string) {\n    this.schedulerStore.set('selectedTimezone', timezone);\n  }\n\n  /**\n   * Sets the language in the scheduler.\n   */\n  public selectLanguage(language: string) {\n    this.schedulerStore.set('selectedLanguage', language);\n    i18next.changeLanguage(language);\n  }\n\n  /**\n   * Toggles showBookingForm\n   * @param value boolean\n   */\n  public async toggleAdditionalData(value: boolean) {\n    if (!value) {\n      // Refetch availability\n      await this.refetchAvailability();\n    }\n    this.schedulerStore.set('showBookingForm', value);\n  }\n\n  /**\n   * Set/update the name of the participant booking the event.\n   */\n  public setParticipantName(name: string) {\n    const { bookingInfo } = this.schedulerStore.state;\n    this.schedulerStore.set('bookingInfo', {\n      ...bookingInfo,\n      primaryParticipant: {\n        ...(bookingInfo?.primaryParticipant as NylasSchedulerBookingData['primaryParticipant']),\n        name,\n      },\n    });\n  }\n\n  /**\n   * Set/update the email of the participant booking the event.\n   */\n  public setParticipantEmail(email: string) {\n    const { bookingInfo } = this.schedulerStore.state;\n    this.schedulerStore.set('bookingInfo', {\n      ...bookingInfo,\n      primaryParticipant: {\n        ...(bookingInfo?.primaryParticipant as NylasSchedulerBookingData['primaryParticipant']),\n        email,\n      },\n    });\n  }\n\n  private async refetchAvailability() {\n    const today = new Date();\n    // Refetch availability\n    const startTime = new Date(today.getFullYear(), today.getMonth(), 1).getTime() / 1000;\n    const startTimeWithOffset = startTime < today.getTime() / 1000 ? Math.floor(today.getTime() / 1000) : startTime;\n    const endTime = new Date(today.getFullYear(), today.getMonth() + 1, 1).getTime() / 1000;\n    const result = await this.getAvailability(startTimeWithOffset, endTime);\n    return result;\n  }\n\n  private async resetStoreStateAndFetchAvailability() {\n    const today = new Date();\n    // Refetch availability\n    const result = await this.refetchAvailability();\n    // Set selected date to first available date\n    const firstAvailableDate = this.schedulerStore.get('availability').find((timeslot: any) => new Date(timeslot.start_time) > new Date());\n    let _selectedDate = today;\n    if (firstAvailableDate) {\n      _selectedDate = firstAvailableDate.start_time;\n    }\n    this.schedulerStore.set('selectedDate', _selectedDate);\n    // Reset store state\n    this.schedulerStore.set('eventInfo', null);\n    this.schedulerStore.set('showBookingForm', false);\n    this.schedulerStore.set('selectedTimeslot', null);\n\n    return result;\n  }\n\n  /**\n   * Set reschedule booking id\n   */\n  public async setReschedule(bookingID: string) {\n    this.schedulerStore.set('isLoading', true);\n    const eventInfo = this.schedulerStore.state.eventInfo;\n    if (eventInfo) {\n      this.schedulerStore.set('reschedulingEventInfo', eventInfo);\n    }\n    this.schedulerStore.set('rescheduleBookingId', bookingID);\n\n    // Set reschedule booking id\n    const result = await this.resetStoreStateAndFetchAvailability().finally(() => {\n      this.schedulerStore.set('isLoading', false);\n    });\n\n    return result;\n  }\n\n  /**\n   * Set cancel booking id\n   */\n  public async setCancel(bookingID: string) {\n    this.schedulerStore.set('cancelBookingId', bookingID);\n  }\n\n  /**\n   * Set reject booking id\n   */\n  public async setReject(bookingID: string) {\n    this.schedulerStore.set('rejectBookingId', bookingID);\n  }\n\n  public async resetCancel() {\n    const result = await this.resetStoreStateAndFetchAvailability();\n    this.schedulerStore.set('cancelBookingId', '');\n    this.schedulerStore.set('rejectBookingId', '');\n    this.schedulerStore.set('cancelledEventInfo', null);\n    return result;\n  }\n\n  public async goBack() {\n    this.schedulerStore.set('cancelBookingId', '');\n    return;\n  }\n\n  public async resetConfirm() {\n    const result = await this.resetStoreStateAndFetchAvailability();\n    this.schedulerStore.set('organizerConfirmationBookingId', '');\n    this.schedulerStore.set('confirmedEventInfo', undefined);\n    return result;\n  }\n\n  /**\n   * Book the selected timeslot.\n   * @param data The booking info.\n   * @returns {Promise<NylasResponse<NylasEvent>>}\n   */\n  public async bookTimeslot(data?: NylasSchedulerBookingData & { timeslot?: Timeslot }): Promise<NylasSchedulerResponse<NylasEvent>> {\n    this.schedulerStore.set('isLoading', true);\n    const { selectedTimeslot, selectedTimezone, bookingInfo, selectedLanguage } = this.schedulerStore.state;\n    if (!data && !bookingInfo) {\n      return { error: this.errors.component(i18next.t('createBookingErrorTitle')).no_booking_info() };\n    }\n\n    const timeslot = data?.timeslot || selectedTimeslot;\n    if (!timeslot) {\n      return { error: this.errors.component(i18next.t('createBookingErrorTitle')).no_timeslot_selected() };\n    }\n\n    const timezone = data && data?.timezone ? data?.timezone : selectedTimezone;\n\n    if (!timezone) {\n      return { error: this.errors.component(i18next.t('createBookingErrorTitle')).no_timezone_selected() };\n    }\n    const order = this.schedulerStore.get('availabilityOrderEmails');\n    let participantToBookWith = '';\n    if (order.length > 0) {\n      // Get the emails in the timeslot\n      const emails = timeslot.emails;\n      for (let i = 0; i < order.length; i++) {\n        if (emails.includes(order[i])) {\n          participantToBookWith = order[i];\n          break;\n        }\n      }\n    }\n    const primaryGuest = data ? data?.primaryParticipant : bookingInfo?.primaryParticipant;\n    const guests = data ? data?.guests || [] : bookingInfo?.guests || [];\n    const additional_fields = data ? data?.additionalFields : bookingInfo?.additionalFields;\n\n    const headers = this.getHeaders();\n    const configIdParam =\n      !this.sessionId && this.configId\n        ? `?configuration_id=${this.configId}`\n        : !this.sessionId && this.slug && this.clientId\n          ? `?slug=${this.slug}&client_id=${this.clientId}`\n          : '';\n    const url = `/v3/scheduling/bookings${configIdParam}`;\n\n    const response = await this.makeAPIRequest<NylasEvent>(\n      decodeURIComponent(url),\n      'POST',\n      JSON.stringify({\n        participants: participantToBookWith ? [{ email: participantToBookWith }] : undefined,\n        additional_fields,\n        additional_guests: guests,\n        guest: { ...primaryGuest },\n        start_time: timeslot.start_time.getTime() / 1000,\n        end_time: timeslot.end_time.getTime() / 1000,\n        timezone: timezone,\n        email_language: this.getTwoLetterLanguageCode(selectedLanguage),\n      }),\n      headers,\n    );\n\n    if ('error' in response) {\n      this.schedulerStore.set('isLoading', false);\n      const errorType = response.error?.type;\n      let error = response.error;\n      if (errorType && errorType in this.errors.api('Create Booking')) {\n        const errorMessage = this.getErrorMessage(error);\n        error = this.errors.api('Create Booking')[errorType as APIErrorType](errorMessage);\n      }\n      return { error };\n    }\n\n    if ('data' in response) {\n      this.schedulerStore.set('eventInfo', response?.data);\n    }\n\n    this.schedulerStore.set('isLoading', false);\n    return response;\n  }\n\n  /**\n   * Get UI settings for the scheduler.\n   */\n  public async getUISettings(): Promise<NylasSchedulerResponse<UISettingsResponse>> {\n    this.schedulerStore.set('isLoading', true);\n    const headers = this.getHeaders();\n    const configIdParam =\n      !this.sessionId && this.configId\n        ? `?configuration_id=${this.configId}`\n        : !this.sessionId && this.slug && this.clientId\n          ? `?slug=${this.slug}&client_id=${this.clientId}`\n          : '';\n    const url = `/v3/scheduling/ui-settings${configIdParam}`;\n\n    const response = await this.makeAPIRequest<UISettingsResponse>(url, 'GET', undefined, headers);\n    if ('error' in response) {\n      this.schedulerStore.set('isLoading', false);\n      const errorType = response.error?.type;\n      let error = response.error;\n      if (errorType && errorType in this.errors.api(i18next.t('getUISettingErrorTitle'))) {\n        error = this.errors.api(i18next.t('getUISettingErrorTitle'))[errorType as APIErrorType](error?.message || error?.title || 'Something went wrong');\n      }\n      return { error };\n    }\n    if ('data' in response) {\n      this.schedulerStore.set('configSettings', response.data);\n    }\n    this.schedulerStore.set('isLoading', false);\n    return response;\n  }\n\n  private getTwoLetterLanguageCode(language: string) {\n    return language.split('-')[0];\n  }\n\n  private getStartTimeWithMinBookingNotice(startTime: number) {\n    const scheduler = this.schedulerStore.get('configSettings')?.scheduler;\n    const min_booking_notice = scheduler?.min_booking_notice;\n    if (!min_booking_notice) {\n      return startTime;\n    }\n    const today = new Date().getTime();\n\n    if (startTime < (today + min_booking_notice * 60 * 1000) / 1000) {\n      return Math.floor((today + min_booking_notice * 60 * 1000) / 1000);\n    } else {\n      return startTime;\n    }\n  }\n\n  private getEndTimeForAvailableDaysInFuture(endTime: number) {\n    const today = new Date();\n    const availableDaysInFuture = this.schedulerStore.get('configSettings')?.scheduler?.available_days_in_future;\n    const endTimeForAvailableDaysInFuture = Math.floor(addDaysToCurrentDate(today, availableDaysInFuture).getTime() / 1000);\n    const endTimeWithOffset = Math.min(endTimeForAvailableDaysInFuture, endTime);\n    return endTimeWithOffset;\n  }\n\n  /**\n   * Gets the availability for a page.\n   * @param startTime The start time.\n   * @param endTime The end time.\n   * @returns {Promise<AvailabilityResponse>}\n   */\n  public async getAvailability(startTime: number = 0, endTime: number = 0): Promise<NylasSchedulerResponse<AvailabilityResponse>> {\n    this.schedulerStore.set('isLoading', true);\n    const params = new URLSearchParams();\n    const now = new Date();\n    const nowTime = now.getTime();\n\n    if (endTime && endTime < nowTime / 1000) {\n      this.schedulerStore.set('isLoading', false);\n      const error = this.errors.component(i18next.t('getAvailabilityErrorTitle')).endtime_not_in_future();\n      return { error };\n    }\n\n    // Calculate the start of the current month if startTime is not provided\n    if (!startTime) {\n      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n      startTime = Math.floor(startOfMonth.getTime() / 1000); // Convert to UNIX timestamp in seconds\n    }\n\n    // Calculate the end of the current month if endTime is not provided\n    if (!endTime) {\n      const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0); // Setting day to 0 gets the last day of the previous month, so in this case, the last day of the current month\n      endTime = Math.floor(endOfMonth.getTime() / 1000); // Convert to UNIX timestamp in seconds\n    }\n\n    endTime = this.getEndTimeForAvailableDaysInFuture(endTime);\n    const startTimeWithMinBooking = this.getStartTimeWithMinBookingNotice(startTime);\n    startTime = startTimeWithMinBooking;\n    endTime = startTimeWithMinBooking > endTime ? startTimeWithMinBooking + 1 : endTime;\n\n    params.append('start_time', encodeURIComponent(startTime.toString()));\n    params.append('end_time', encodeURIComponent(endTime.toString()));\n    if (this.configId && !this.sessionId) {\n      params.append('configuration_id', encodeURIComponent(this.configId));\n    } else if (this.slug && this.clientId && !this.sessionId) {\n      params.append('slug', encodeURIComponent(this.slug));\n      params.append('client_id', encodeURIComponent(this.clientId));\n    }\n\n    const rescheduleBookingId = this.schedulerStore.get('rescheduleBookingId');\n    if (rescheduleBookingId) {\n      params.append('booking_id', encodeURIComponent(rescheduleBookingId));\n    }\n    const queryString = params.toString();\n    const url = `/v3/scheduling/availability${queryString ? `?${queryString}` : ''}`;\n    const headers = this.getHeaders();\n    const response = await this.makeAPIRequest<AvailabilityResponse>(decodeURIComponent(url), 'GET', undefined, headers);\n\n    if ('error' in response) {\n      this.schedulerStore.set('availability', []);\n      this.schedulerStore.set('isLoading', false);\n      const errorType = response.error?.type;\n      let error = response.error;\n      if (errorType && errorType in this.errors.api(i18next.t('getAvailabilityErrorTitle'))) {\n        const errorMessage = this.getErrorMessage(error);\n        error = this.errors.api(i18next.t('getAvailabilityErrorTitle'))[errorType as APIErrorType](errorMessage);\n      }\n      return { error };\n    }\n\n    if ('data' in response) {\n      const availability =\n        response.data?.time_slots?.map(timeslot => {\n          return {\n            ...timeslot,\n            start_time: new Date(timeslot.start_time * 1000),\n            end_time: new Date(timeslot.end_time * 1000),\n          };\n        }) || [];\n\n      // Filter out timeslots that are in the past\n      const availabilityTimeslotsFiltered = availability.filter(timeslot => timeslot.start_time.getTime() > nowTime);\n      this.schedulerStore.set('availability', availabilityTimeslotsFiltered);\n      const order = response.data?.order || [];\n      this.schedulerStore.set('availabilityOrderEmails', order);\n    }\n\n    this.schedulerStore.set('isLoading', false);\n    return response;\n  }\n\n  /**\n   * Cancels a booking.\n   * @param bookingId The booking ID.\n   */\n  public async cancelBooking(bookingId: string, reason: string): Promise<NylasSchedulerResponse<Partial<NylasEvent>>> {\n    this.schedulerStore.set('isLoading', true);\n    if (!bookingId) {\n      return { error: this.errors.component(i18next.t('cancelBookingErrorTitle')).no_booking_id() };\n    }\n    const configIdParam =\n      !this.sessionId && this.configId\n        ? `?configuration_id=${this.configId}`\n        : !this.sessionId && this.slug && this.clientId\n          ? `?slug=${this.slug}&client_id=${this.clientId}`\n          : '';\n    const url = `/v3/scheduling/bookings/${bookingId}${configIdParam}`;\n    const headers = this.getHeaders();\n    const response = await this.makeAPIRequest<Partial<NylasEvent>>(\n      decodeURIComponent(url),\n      'DELETE',\n      JSON.stringify({\n        action: 'cancel',\n        cancellation_reason: reason,\n      }),\n      headers,\n    );\n\n    if ('error' in response) {\n      this.schedulerStore.set('isLoading', false);\n      const errorType = response.error?.type;\n      let error = response.error;\n      if (errorType && errorType in this.errors.api(i18next.t('cancelBookingErrorTitle'))) {\n        const errorMessage = this.getErrorMessage(error);\n        error = this.errors.api(i18next.t('cancelBookingErrorTitle'))[errorType as APIErrorType](errorMessage);\n      }\n      return { error };\n    }\n\n    this.schedulerStore.set('cancelledEventInfo', {\n      booking_id: bookingId,\n    });\n    this.schedulerStore.set('rescheduleBookingId', '');\n    this.schedulerStore.set('isLoading', false);\n    return response;\n  }\n\n  /**\n   * Reschedules a booking.\n   * @param bookingId The booking ID.\n   * @param data The booking info.\n   * @returns {Promise<NylasResponse<NylasEvent>>}\n   */\n  public async rescheduleBooking(bookingId: string, data: NylasSchedulerBookingData): Promise<NylasSchedulerResponse<NylasEvent>> {\n    this.schedulerStore.set('isLoading', true);\n    if (!bookingId) {\n      return { error: this.errors.component(i18next.t('rescheduleBookingErrorTitle')).no_booking_id() };\n    }\n    const apiErrors = this.errors.api(i18next.t('rescheduleBookingErrorTitle'));\n    const componentErrors = this.errors.component(i18next.t('rescheduleBookingErrorTitle'));\n    const { bookingInfo, selectedTimeslot, selectedTimezone, selectedLanguage } = this.schedulerStore.state;\n    // Validate data\n    const { startTime, endTime, timezone } = data;\n    const start_time = startTime || selectedTimeslot?.start_time;\n\n    if (!start_time) {\n      return { error: componentErrors.invalid_start_time('Please pass \"startTime\" in data or set \"selectedTimeslot\" in the defaultSchedulerState.') };\n    }\n    const end_time = endTime || selectedTimeslot?.end_time;\n    if (!end_time) {\n      return { error: componentErrors.invalid_end_time('Please pass \"endTime\" in data or set \"selectedTimeslot\" in the defaultSchedulerState.') };\n    }\n\n    const order = this.schedulerStore.get('availabilityOrderEmails');\n    let participantToBookWith = '';\n    if (order.length > 0) {\n      // Get the emails in the timeslot\n      const emails = selectedTimeslot?.emails || [];\n      for (let i = 0; i < order.length; i++) {\n        if (emails.includes(order[i])) {\n          participantToBookWith = order[i];\n          break;\n        }\n      }\n    }\n\n    const time_zone = timezone || selectedTimezone;\n    if (!time_zone) {\n      return { error: componentErrors.invalid_timezone('Please pass \"timezone\" in data or set \"selectedTimezone\" in the defaultSchedulerState.') };\n    }\n\n    const primaryGuest = data ? data?.primaryParticipant : bookingInfo?.primaryParticipant;\n    const guests = data ? data?.guests || [] : bookingInfo?.guests || [];\n    const additional_fields = data ? data?.additionalFields : bookingInfo?.additionalFields;\n\n    const configIdParam =\n      !this.sessionId && this.configId\n        ? `?configuration_id=${this.configId}`\n        : !this.sessionId && this.slug && this.clientId\n          ? `?slug=${this.slug}&client_id=${this.clientId}`\n          : '';\n    const url = `/v3/scheduling/bookings/${bookingId}${configIdParam}`;\n    const headers = this.getHeaders();\n    const response = await this.makeAPIRequest<NylasEvent>(\n      decodeURIComponent(url),\n      'PATCH',\n      JSON.stringify({\n        start_time: start_time.getTime() / 1000,\n        end_time: end_time.getTime() / 1000,\n        timezone: time_zone,\n        additional_fields,\n        guest: { ...primaryGuest },\n        additional_guests: guests,\n        participants: participantToBookWith ? [{ email: participantToBookWith }] : undefined,\n        email_language: this.getTwoLetterLanguageCode(selectedLanguage),\n      }),\n      headers,\n    );\n\n    if ('error' in response) {\n      this.schedulerStore.set('isLoading', false);\n      const errorType = response.error?.type;\n      let error = response.error;\n      if (errorType && errorType in apiErrors) {\n        const errorMessage = this.getErrorMessage(error);\n        error = apiErrors[errorType as APIErrorType](errorMessage);\n      }\n      return { error };\n    }\n\n    const eventInfo = this.schedulerStore.get('reschedulingEventInfo');\n    if ('data' in response) {\n      this.schedulerStore.set('eventInfo', response?.data);\n    } else if (eventInfo) {\n      this.schedulerStore.set('eventInfo', eventInfo);\n    } else {\n      // We should technically never reach this point\n      const event = {\n        booking_id: bookingId,\n      } as NylasEvent;\n      this.schedulerStore.set('eventInfo', event);\n    }\n\n    this.schedulerStore.set('isLoading', false);\n    return response;\n  }\n\n  /**\n   * Updates the booking.\n   * @param bookingId The booking ID.\n   */\n  public async updateBooking(payload: { bookingId: string; status: 'confirmed' | 'cancelled'; reason?: string }): Promise<NylasSchedulerResponse<NylasEvent>> {\n    this.schedulerStore.set('isLoading', true);\n    const { bookingId, status, reason } = payload;\n    const salt = this.schedulerStore.get('organizerConfirmationSalt');\n    const errorTitle = status === 'confirmed' ? i18next.t('confirmBookingErrorTitle') : i18next.t('rejectBookingErrorTitle');\n\n    if (!bookingId) {\n      return { error: this.errors.component(errorTitle).no_booking_id() };\n    }\n    if (!salt) {\n      return { error: this.errors.component(errorTitle).no_salt() };\n    }\n\n    const configIdParam =\n      !this.sessionId && this.configId\n        ? `?configuration_id=${this.configId}`\n        : !this.sessionId && this.slug && this.clientId\n          ? `?slug=${this.slug}&client_id=${this.clientId}`\n          : '';\n    const url = `/v3/scheduling/bookings/${bookingId}${configIdParam}`;\n    const headers = this.getHeaders();\n    const response = await this.makeAPIRequest<NylasEvent>(\n      decodeURIComponent(url),\n      'PUT',\n      JSON.stringify({\n        status: status,\n        cancellation_reason: reason,\n        salt,\n      }),\n      headers,\n    );\n\n    if ('error' in response) {\n      this.schedulerStore.set('isLoading', false);\n      const errorType = response.error?.type;\n      let error = response.error;\n      if (errorType && errorType in this.errors.api(errorTitle)) {\n        const errorMessage = this.getErrorMessage(error);\n        error = this.errors.api(errorTitle)[errorType as APIErrorType](errorMessage);\n      }\n      return { error };\n    }\n\n    if ('data' in response && status === 'confirmed') {\n      this.schedulerStore.set('confirmedEventInfo', response?.data);\n    } else if ('request_id' in response && status === 'cancelled') {\n      this.schedulerStore.set('cancelledEventInfo', {\n        booking_id: bookingId,\n      });\n    }\n\n    this.schedulerStore.set('organizerConfirmationBookingId', '');\n    this.schedulerStore.set('isLoading', false);\n    return response;\n  }\n}\n","import { DataState, NylasEvent } from '@/common/types';\nimport { debug } from '@/utils/utils';\nimport { AdditionalFields, Appearance, NylasSchedulerBookingData, Timeslot } from '@nylas/core';\nimport { createStore } from '@stencil/store';\n\nexport type AvailabilityTimeslot = {\n  emails: string[];\n  start_time: Date;\n  end_time: Date;\n};\n\nexport type LoadingState = {\n  api: 'availability' | 'createBooking' | 'cancelBooking' | 'rescheduleBooking';\n};\n\nexport type ConfigSettings = {\n  scheduler: {\n    available_days_in_future: number;\n    min_cancellation_notice: number;\n    min_booking_notice: number;\n    rescheduling_url?: string;\n    cancellation_url?: string;\n    cancellation_policy?: string;\n    hide_additional_guests?: boolean;\n    hide_cancellation_options?: boolean;\n    hide_rescheduling_options?: boolean;\n    additional_fields?: Record<string, AdditionalFields>;\n    confirmation_redirect_url?: string;\n    organizer_confirmation_url?: string;\n  };\n  organizer: {\n    name: string;\n    email: string;\n  };\n  slug: string;\n  appearance: Appearance;\n  booking_type: string;\n  name: string;\n};\n\nexport interface NylasSchedulerStoreState {\n  selectedDate: Date | null;\n  selectedLanguage: string;\n  selectedTimezone: string;\n  selectedTimeslot: Timeslot | null;\n  availabilityOrderEmails: string[];\n  showBookingForm: boolean;\n  selectableDates: Date[] | null;\n  eventDuration: number;\n  availability: AvailabilityTimeslot[];\n  state: DataState;\n  eventInfo: NylasEvent | null;\n  cancelledEventInfo: Partial<NylasEvent> | null;\n  reschedulingEventInfo?: NylasEvent;\n  confirmedEventInfo?: NylasEvent;\n  bookingInfo?: NylasSchedulerBookingData;\n  rescheduleBookingId?: string;\n  cancelBookingId?: string;\n  isLoading: boolean;\n  nylasBranding?: boolean;\n  configSettings?: ConfigSettings;\n  organizerConfirmationBookingId?: string;\n  rejectBookingId?: string;\n  organizerConfirmationSalt?: string;\n}\n\nexport type NylasSchedulerStoreType = ReturnType<typeof CreateNylasSchedulerStore>;\n\nexport function CreateNylasSchedulerStore(defaultState: Partial<NylasSchedulerStoreState> = {}) {\n  const defaultNylasStoreState: NylasSchedulerStoreState = {\n    selectedDate: null,\n    selectedLanguage: navigator.language,\n    selectedTimezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n    selectedTimeslot: null,\n    showBookingForm: false,\n    availabilityOrderEmails: [],\n    selectableDates: null,\n    availability: [],\n    eventDuration: 0,\n    state: 'ready',\n    eventInfo: null,\n    cancelledEventInfo: null,\n    isLoading: false,\n    nylasBranding: true,\n    ...defaultState,\n  };\n  debug(`[defaultNylasStoreState]: `, defaultNylasStoreState);\n  const store = createStore<NylasSchedulerStoreState>(defaultNylasStoreState);\n\n  store.onChange('availability', availability => {\n    debug(`[availability]: `, availability);\n    const selectableDates = availability.map(timeslot => timeslot.start_time);\n    debug(`[selectableDates]: `, selectableDates);\n    store.set('selectableDates', selectableDates);\n    const timeslot = availability[0];\n    if (!timeslot) return;\n    const durationMinutes = Math.floor((timeslot.end_time.getTime() - timeslot.start_time.getTime()) / 60000);\n    debug(`[durationMinutes]: `, durationMinutes);\n    store.set('eventDuration', durationMinutes);\n  });\n\n  /**\n   * Reset the Nylas store to its default state.\n   * There is something wrong with the stencil/store reset method,\n   * so we have to do it via this hack.\n   */\n  store.reset = () => {\n    for (const key in defaultNylasStoreState) {\n      const value = defaultNylasStoreState[key as keyof typeof defaultNylasStoreState];\n      store.set(key as any, value);\n    }\n  };\n\n  return store;\n}\n"],"version":3}