{"version":3,"file":"nylas-cancel-booking-form.js","sourceRoot":"","sources":["../../../../src/components/scheduler/nylas-cancel-booking-form/nylas-cancel-booking-form.tsx"],"names":[],"mappings":"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","sourcesContent":["import { RegisterComponent } from '@/common/register-component';\nimport { Component, Event, EventEmitter, h, Host, Listen, Prop, State, Watch } from '@stencil/core';\nimport { NylasSchedulerConnector } from '../../..';\nimport { NylasScheduling } from '../nylas-scheduling/nylas-scheduling';\nimport { debug } from '@/utils/utils';\nimport { Notification, NylasSchedulerErrorResponse, Timeslot } from '@nylas/core';\nimport { ConfigSettings } from '@/stores/scheduler-store';\nimport i18next from '@/utils/i18n';\nimport { NylasEvent } from '@/common/types';\n\n/**\n * The `nylas-cancel-booking-form` component is a UI component that allows users to cancel a booking (DELETE request).\n * This component is also used to reject a booking (PUT request) by the organizer, if the prop `rejectBookingId` is provided.\n *\n * @part ncbf - The cancel booking form container.\n * @part ncbf__icon - The calendar icon.\n * @part ncbf__title - The title of the cancel booking form.\n * @part ncbf__description - The description of the cancel booking form.\n * @part ncbf__reason-textarea - The reason textarea.\n * @part ncbf__button-cta - The cancel booking form CTA button.\n * @part ncbf__button-outline - The cancel booking form outline button.\n * @part ncbf__card - The cancel booking form card.\n */\n@Component({\n  tag: 'nylas-cancel-booking-form',\n  styleUrl: 'nylas-cancel-booking-form.scss',\n  shadow: true,\n})\nexport class NylasCancelBookingForm {\n  /**\n   * The booking ID to cancel.\n   */\n  @Prop() readonly cancelBookingId?: string;\n\n  /**\n   * The booking ID to reject.\n   */\n  @Prop() readonly rejectBookingId?: string;\n\n  /**\n   * The config settings.\n   */\n  @Prop() readonly configSettings?: ConfigSettings;\n\n  /**\n   * The event info.\n   */\n  @Prop() readonly eventInfo?: NylasEvent;\n\n  /**\n   * The selected timeslot.\n   */\n  @Prop() readonly selectedTimeslot!: Timeslot;\n\n  /**\n   * The loading state.\n   */\n  @Prop() readonly isLoading?: boolean;\n\n  /**\n   * This event is fired when the Go back button is clicked on the cancel booking form.\n   */\n  @Event() readonly goBackButtonClicked!: EventEmitter<void>;\n\n  /**\n   * This event is fired when the cancel booking form is submitted.\n   */\n  @Event() readonly cancelBookingFormSubmitted!: EventEmitter<{\n    bookingId: string;\n    action: 'reject' | 'cancel';\n    reason: string;\n    errorHandler?: (error: NylasSchedulerErrorResponse) => void;\n  }>;\n\n  /**\n   * This event is only for triggering the validation on the text area for cancellation reason. This is for internal purposes only.\n   */\n  @Event() readonly triggerValidation!: EventEmitter<{}>;\n  /**\n   * This event is fired when an error occurs while cancelling the booking.\n   */\n  @Event() readonly cancelBookedEventError!: EventEmitter<NylasSchedulerErrorResponse>;\n\n  /**\n   * This event is fired when an error occurs in the booking form.\n   */\n  @Event() cancelBookingFormError!: EventEmitter<Partial<Notification>>;\n\n  /**\n   * The reason for cancellation.\n   */\n  @State() cancellationReason: string = '';\n\n  @State() cancellationError: string = '';\n\n  @State() cancellationPolicy: string = this.configSettings?.scheduler?.cancellation_policy || 'Your current timeslot will become available to others.';\n\n  @Watch('configSettings')\n  configSettingsChangedHandler(newValue: ConfigSettings) {\n    this.cancellationPolicy = newValue?.scheduler?.cancellation_policy || 'Your current timeslot will become available to others.';\n  }\n\n  connectedCallback() {\n    debug(`[nylas-cancel-booking-form] Component connected`);\n  }\n\n  async componentWillLoad() {\n    debug(`[nylas-cancel-booking-form] Component will load`);\n  }\n\n  async componentDidLoad() {\n    debug(`[nylas-cancel-booking-form] Component did load`);\n    if (!this.cancelBookingId) {\n      console.warn(`[nylas-cancel-booking-form] No booking ID provided, \"cancelBookingId\" prop is required.`);\n    }\n  }\n\n  disconnectedCallback() {\n    debug(`[nylas-cancel-booking-form] Component disconnected`);\n  }\n\n  private handleGoBackClicked = () => {\n    this.goBackButtonClicked.emit();\n  };\n\n  private handleSubmitCancelBooking = (event: Event) => {\n    this.triggerValidation.emit({});\n    event.preventDefault();\n    if (!this.cancellationReason) {\n      this.cancellationError = i18next.t('cancellationErrorMessage');\n      this.cancelBookingFormError.emit({ title: i18next.t('cancelBokingFormError'), description: i18next.t('cancellationErrorMessage') });\n      return;\n    }\n\n    const minCancellationNotice = this.configSettings?.scheduler?.min_cancellation_notice;\n    if (this.selectedTimeslot && minCancellationNotice) {\n      const startTime = new Date(this.selectedTimeslot?.start_time);\n      const dateTillCancellation = startTime.getTime() - minCancellationNotice * 60 * 1000;\n\n      if (dateTillCancellation < new Date().getTime()) {\n        this.cancelBookedEventError.emit({\n          error: {\n            title: i18next.t('cancellationErrorTitle'),\n            message: i18next.t('minimumCancellationNoticeErrorMessage', { minCancellationNotice }),\n          },\n        });\n        return;\n      }\n    }\n\n    debug(`[nylas-cancel-booking-form] Cancel booking form submitted with reason: ${this.cancellationReason}`);\n    const errorHandler = (error: NylasSchedulerErrorResponse) => {\n      this.cancelBookedEventError.emit(error);\n    };\n    if (this.cancelBookingId) {\n      this.cancelBookingFormSubmitted.emit({ bookingId: this.cancelBookingId, action: 'cancel', reason: this.cancellationReason, errorHandler });\n    } else if (this.rejectBookingId) {\n      this.cancelBookingFormSubmitted.emit({ bookingId: this.rejectBookingId, action: 'reject', reason: this.cancellationReason, errorHandler });\n    }\n  };\n\n  @Listen('nylasFormInputChanged')\n  handleNylasFormInputChanged(event: CustomEvent<{ value: string; name: string; error: string; label: string; type: string }>) {\n    this.triggerValidation.emit({});\n    if (event.detail.name === 'cancel-reason') {\n      this.cancellationReason = event.detail.value;\n      this.cancellationError = event.detail.error;\n    }\n  }\n\n  @RegisterComponent<NylasCancelBookingForm, NylasSchedulerConnector, Exclude<NylasScheduling['stores'], undefined>>({\n    name: 'nylas-cancel-booking-form',\n    stateToProps: new Map([\n      ['scheduler.configSettings', 'configSettings'],\n      ['scheduler.selectedTimeslot', 'selectedTimeslot'],\n      ['scheduler.eventInfo', 'eventInfo'],\n      ['scheduler.isLoading', 'isLoading'],\n      ['scheduler.cancelBookingId', 'cancelBookingId'],\n      ['scheduler.rejectBookingId', 'rejectBookingId'],\n    ]),\n    eventToProps: {\n      cancelBookingFormSubmitted: async (\n        event: CustomEvent<{ bookingId: string; action: 'reject' | 'cancel'; reason: string; errorHandler?: (error: NylasSchedulerErrorResponse) => void }>,\n        nylasSchedulerConnector: NylasSchedulerConnector,\n      ) => {\n        const { action, errorHandler } = event.detail;\n        if (action === 'cancel') {\n          const result = await nylasSchedulerConnector.scheduler.cancelBooking(event.detail.bookingId, event.detail.reason);\n          if (errorHandler && (!result || 'error' in result)) {\n            errorHandler(result);\n          }\n        } else if (action === 'reject') {\n          const result = await nylasSchedulerConnector.scheduler.updateBooking({\n            bookingId: event.detail.bookingId,\n            status: 'cancelled',\n            reason: event.detail.reason,\n          });\n          if (errorHandler && (!result || 'error' in result)) {\n            errorHandler(result);\n          }\n        }\n      },\n      goBackButtonClicked: async (event: CustomEvent<void>, nylasSchedulerConnector: NylasSchedulerConnector) => {\n        debug('nylas-cancel-booking-form', 'goBackButtonClicked', event.detail);\n        nylasSchedulerConnector.scheduler.goBack();\n      },\n      cancelBookedEventError: async (event: CustomEvent<NylasSchedulerErrorResponse>, _nylasSchedulerConnector: NylasSchedulerConnector) => {\n        debug('nylas-cancel-booking-form', 'cancelBookedEventError', event.detail);\n      },\n      cancelBookingFormError: async (event: CustomEvent<Partial<Notification>>, _nylasSchedulerConnector: NylasSchedulerConnector) => {\n        debug('nylas-cancel-booking-form', 'cancelBookingFormError', event.detail);\n      },\n    },\n    fireRegisterEvent: true,\n  })\n  render() {\n    return (\n      <Host part=\"ncbf\">\n        <div class=\"nylas-cancel-booking-form\" part=\"ncbf__card\">\n          <div class=\"nylas-cancel-booking-form__calendar-icon\" part=\"ncbf__icon\">\n            <calendar-cancel-icon />\n          </div>\n          <h3 class=\"nylas-cancel-booking-form__title\" part=\"ncbf__title\">\n            {i18next.t('cancelBookingTitle')}\n          </h3>\n          <div class=\"nylas-cancel-booking-form__description\" part=\"ncbf__description\">\n            {!this.configSettings?.scheduler?.cancellation_policy ? `${i18next.t('cancelBookingMessage')}` : this.cancellationPolicy}\n          </div>\n          <form onSubmit={this.handleSubmitCancelBooking}>\n            <textarea-component\n              id=\"cancel-reason\"\n              name=\"cancel-reason\"\n              required={true}\n              label={i18next.t('reasonForCancellation')}\n              class={this.cancellationError ? 'error' : ''}\n              part=\"ncbf__reason-textarea\"\n              defaultValue={this.cancellationReason}\n            ></textarea-component>\n            <div class=\"footer\">\n              <button-component variant={'destructive'} class=\"cancel\" type=\"submit\" part=\"ncbf__button-cta\" disabled={this.isLoading}>\n                {i18next.t('cancelBookingButton')}\n              </button-component>\n              {!!this.eventInfo && (\n                <button-component variant={'basic'} class=\"back\" part=\"ncbf__button-outline\" onClick={this.handleGoBackClicked}>\n                  {i18next.t('goBackButton')}\n                </button-component>\n              )}\n            </div>\n          </form>\n        </div>\n      </Host>\n    );\n  }\n}\n"]}