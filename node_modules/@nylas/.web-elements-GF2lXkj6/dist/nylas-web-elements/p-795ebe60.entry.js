import{h,F as Fragment,r as registerInstance,c as createEvent,H as Host,a as getElement}from"./p-68c2fadf.js";import{X as Xr,N as NylasBaseProvider}from"./p-7d71679f.js";import{N as NylasIdentityRequestWrapper}from"./p-d8ef0791.js";import{d as dataResponse,a as debug,B as Buffer,p as process}from"./p-c6fcb288.js";import{C as CreateNylasSchedulerConfigStore}from"./p-23715357.js";import{c as commonjsGlobal}from"./p-cb65c223.js";import"./p-cabb2e68.js";class NylasSchedulerConfigAPIConnector{constructor({nylasApiRequest:t,nylasSchedulerConfigStore:e}){this.nylasApiRequest=t;this.nylasSchedulerConfigStore=e}async currentUser(){if(!this.nylasApiRequest){console.warn("Nylas API Request is not initialized");return null}return this.nylasApiRequest.currentUser()}async getCalendars(){if(!this.nylasApiRequest){console.warn("Nylas API Request is not initialized");return dataResponse(null,{message:"Error fetching calendars: Nylas API Request is not initialized"})}const[t,e]=await this.nylasApiRequest.request({method:"GET",path:`calendars`});if(e){return dataResponse(null,{message:"Error fetching calendars: "+e.message})}if(Xr(t)){return dataResponse(null,{message:"Error fetching calendars: "+t.error?.message})}this.nylasSchedulerConfigStore.state.calendars=t.data;return dataResponse(t.data)}async getConfigurationById(t,e=false){if(!this.nylasApiRequest){console.warn("Nylas API Request is not initialized");return dataResponse(null,{message:"Error fetching configuration: Nylas API Request is not initialized"})}if(!e){const e=this.nylasSchedulerConfigStore.state.configurations.find((e=>e.id===t));if(e){this.nylasSchedulerConfigStore.state.selectedConfiguration=e;return dataResponse(e)}}const[n,i]=await this.nylasApiRequest.request({method:"GET",path:`scheduling/configurations/${t}`});if(i){return dataResponse(null,{message:"Error fetching configuration: "+i.message})}if(Xr(n)){return dataResponse(null,{message:"Error fetching configuration: "+n.error?.message})}this.nylasSchedulerConfigStore.state.selectedConfiguration=n.data;if(this.nylasSchedulerConfigStore.state.configurations.find((e=>e.id===t))){this.nylasSchedulerConfigStore.state.configurations=this.nylasSchedulerConfigStore.state.configurations.map((e=>e.id===t?n.data:e))}else{this.nylasSchedulerConfigStore.state.configurations=[...this.nylasSchedulerConfigStore.state.configurations,n.data]}return dataResponse(n.data)}async getConfigurations(t){if(!this.nylasApiRequest){console.warn("Nylas API Request is not initialized");return dataResponse(null,{message:"Error fetching configurations: Nylas API Request is not initialized"})}const e=50;const[n,i]=await this.nylasApiRequest.request({method:"GET",path:`scheduling/configurations?limit=${e}${t?`&page_token=${t}`:""}`});if(i){return dataResponse(null,{message:"Error fetching configurations: "+i.message})}if(Xr(n)){return dataResponse(null,{message:"Error fetching configurations: "+n.error?.message})}this.nylasSchedulerConfigStore.state.configurations=n.data;this.nylasSchedulerConfigStore.state.listConfigurationsNextCursor=n.next_cursor||null;return dataResponse(n.data)}async createConfiguration(t){if(!this.nylasApiRequest){console.warn("Nylas API Request is not initialized");return dataResponse(null,{message:"Error creating configuration: Nylas API Request is not initialized"})}const[e,n]=await this.nylasApiRequest.request({method:"POST",path:`scheduling/configurations`,body:t});if(n){return dataResponse(null,{message:"Error creating configuration: "+n.message})}if(Xr(e)){return dataResponse(null,{message:"Error creating configuration: "+e.error?.message})}this.nylasSchedulerConfigStore.state.selectedConfiguration=e.data;this.nylasSchedulerConfigStore.state.configurations=[...this.nylasSchedulerConfigStore.state.configurations,e.data];return dataResponse(e.data)}async updateConfiguration(t){if(!this.nylasApiRequest){console.warn("Nylas API Request is not initialized");return dataResponse(null,{message:"Error updating configuration: Nylas API Request is not initialized"})}const[e,n]=await this.nylasApiRequest.request({method:"PUT",path:`scheduling/configurations/${t.id}`,body:t});if(n){return dataResponse(null,{message:"Error updating configuration: "+n.message})}if(Xr(e)){return dataResponse(null,{message:"Error updating configuration: "+e.error?.message})}this.nylasSchedulerConfigStore.state.selectedConfiguration=e.data;if(this.nylasSchedulerConfigStore.state.configurations.find((e=>e.id===t.id))){this.nylasSchedulerConfigStore.state.configurations=this.nylasSchedulerConfigStore.state.configurations.map((n=>n.id===t.id?e.data:n))}else{this.nylasSchedulerConfigStore.state.configurations=[...this.nylasSchedulerConfigStore.state.configurations,e.data]}return dataResponse(e.data)}async deleteConfiguration(t){if(!this.nylasApiRequest){console.warn("Nylas API Request is not initialized");return dataResponse(null,{message:"Error deleting configuration: Nylas API Request is not initialized"})}const[e,n]=await this.nylasApiRequest.request({method:"DELETE",path:`scheduling/configurations/${t}`});if(n){return dataResponse(null,{message:"Error deleting configuration: "+n.message})}if(Xr(e)){return dataResponse(null,{message:"Error deleting configuration: "+e.error?.message})}this.nylasSchedulerConfigStore.state.configurations=this.nylasSchedulerConfigStore.state.configurations.filter((e=>e.id!==t));if(this.nylasSchedulerConfigStore.state.selectedConfiguration?.id===t){this.nylasSchedulerConfigStore.resetSelectedConfiguration()}return dataResponse(e.data)}}class NylasSchedulerConfigConnector{constructor({nylasApiRequest:t,nylasSchedulerConfigStore:e}){this.nylasApiRequest=t;this.nylasSchedulerConfigStore=e}init(){debug("NylasSchedulerConfigConnector init")}get schedulerConfigStore(){return this.nylasSchedulerConfigStore}get schedulerConfig(){if(this._schedulerConfigConnector){return this._schedulerConfigConnector}this._schedulerConfigConnector=new NylasSchedulerConfigAPIConnector({nylasApiRequest:this.nylasApiRequest,nylasSchedulerConfigStore:this.nylasSchedulerConfigStore});return this._schedulerConfigConnector}resetStores(){debug("NylasSchedulerConfigConnector resetStores");this.nylasSchedulerConfigStore.reset()}async logout(){debug("NylasSchedulerConfigConnector logout");this.resetStores()}}class LocalStorage{get(t){return new Promise((e=>{const n=window.localStorage.getItem(t);if(!n){e(null)}else{e(JSON.parse(n))}}))}async remove(t){window.localStorage.removeItem(t);return new Promise((t=>{t(null)}))}set(t,e){window.localStorage.setItem(t,JSON.stringify(e));return new Promise((t=>{t(null)}))}}const PKCE_KEY="pkce";const GRANT_KEY="grant";const USER_KEY="user";class Storage{Storage=new LocalStorage;constructor(t){if(t){this.Storage=t;return}}setPKCE(t){const e=Buffer.from(t);this.Storage.set(PKCE_KEY,e.toString("base64"))}async getPKCE(){try{const t=await this.Storage.get(PKCE_KEY);if(t){const e=Buffer.from(t,"base64");return e.toString("utf8")}}catch(t){return null}return null}removePKCE(){this.Storage.remove(PKCE_KEY)}setGrant(t,e=false){const{grant_id:n}=t;this.Storage.set(`${GRANT_KEY}${e?"-"+n:""}`,t)}removeGrant(t,e=false){this.Storage.remove(`${GRANT_KEY}${e?"-"+t:""}`)}async getGrant(t,e=false){const n=await this.Storage.get(`${GRANT_KEY}${e?"-"+t:""}`);if(n){return n}return null}async setUserToken(t){const e=await this.getUserTokens();if(e){const n=e.find((e=>e.sub===t.sub));if(!n){const n=[...e,t];this.Storage.set(USER_KEY,n)}else{const n=e.map((e=>{if(e.sub===t.sub){e=t}return e}));this.Storage.set(USER_KEY,n)}}else{this.Storage.set(USER_KEY,[t])}}async getUserToken(t=""){const e=await this.Storage.get(USER_KEY);if(e){if(t===""){return e[0]}const n=e.find((e=>e.sub===t));return n}return null}async getUserTokens(){const t=await this.Storage.get(USER_KEY);if(t){return t}return null}removeUserTokens(){this.Storage.remove(USER_KEY)}async removeUserToken(t){const e=await this.getUserTokens();const n=e?.filter((e=>e.sub!==t));this.Storage.set(USER_KEY,n)}async clearSession(){const t=await this.getUserTokens();t?.forEach((t=>{this.removeGrant(t.sub)}));this.removePKCE();this.removeUserTokens()}}class IndexedDBStorage{databaseName="identity-db";storeName="identity";get(t){const e=this;return new Promise(((n,i)=>{e.openDatabase().then((function(r){const s=r.transaction(e.storeName,"readwrite");const o=s.objectStore(e.storeName);const a=o.get(t);a.onsuccess=()=>{n(a.result)};a.onerror=()=>{i(a.error)};s.oncomplete=()=>{r.close()}}))}))}async remove(t){const e=this;return new Promise(((n,i)=>{const r=indexedDB.open(this.databaseName);r.onupgradeneeded=function(t){const n=t.target.result;n.createObjectStore(e.storeName)};r.onerror=()=>{i(r.error)};r.onsuccess=e=>{const r=e.target.result;const s=r.transaction(this.storeName,"readwrite");const o=s.objectStore(this.storeName);const a=o.delete(t);a.onsuccess=()=>{n(null)};a.onerror=()=>{i(a.error)};s.oncomplete=()=>{r.close()}}}))}set(t,e){return new Promise(((n,i)=>{const r=indexedDB.open(this.databaseName);r.onerror=()=>{i(r.error)};r.onupgradeneeded=t=>{const e=t.target.result;e.createObjectStore(this.storeName)};r.onsuccess=r=>{const s=r.target.result;const o=s.transaction(this.storeName,"readwrite");const a=o.objectStore(this.storeName);const c=a.put(e,t);c.onsuccess=()=>{n(e)};c.onerror=()=>{i(c.error)};o.oncomplete=()=>{s.close()}}}))}openDatabase(){const t=this;return new Promise((function(e,n){const i=indexedDB.open(t.databaseName,2);i.onupgradeneeded=function(e){const n=e.target.result;n.createObjectStore(t.storeName)};i.onsuccess=function(t){e(t.target.result)};i.onerror=function(t){n(t.error)}}))}}var sha256={exports:{}};(function(module){(function(){var ERROR="input is invalid type";var WINDOW=typeof window==="object";var root=WINDOW?window:{};if(root.JS_SHA256_NO_WINDOW){WINDOW=false}var WEB_WORKER=!WINDOW&&typeof self==="object";var NODE_JS=!root.JS_SHA256_NO_NODE_JS&&typeof process==="object"&&process.versions&&process.versions.node;if(NODE_JS){root=commonjsGlobal}else if(WEB_WORKER){root=self}var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&"object"==="object"&&module.exports;var ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&typeof ArrayBuffer!=="undefined";var HEX_CHARS="0123456789abcdef".split("");var EXTRA=[-2147483648,8388608,32768,128];var SHIFT=[24,16,8,0];var K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var OUTPUT_TYPES=["hex","array","digest","arrayBuffer"];var blocks=[];if(root.JS_SHA256_NO_NODE_JS||!Array.isArray){Array.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"}}if(ARRAY_BUFFER&&(root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)){ArrayBuffer.isView=function(t){return typeof t==="object"&&t.buffer&&t.buffer.constructor===ArrayBuffer}}var createOutputMethod=function(t,e){return function(n){return new Sha256(e,true).update(n)[t]()}};var createMethod=function(t){var e=createOutputMethod("hex",t);if(NODE_JS){e=nodeWrap(e,t)}e.create=function(){return new Sha256(t)};e.update=function(t){return e.create().update(t)};for(var n=0;n<OUTPUT_TYPES.length;++n){var i=OUTPUT_TYPES[n];e[i]=createOutputMethod(i,t)}return e};var nodeWrap=function(method,is224){var crypto=eval("require('crypto')");var Buffer=eval("require('buffer').Buffer");var algorithm=is224?"sha224":"sha256";var nodeMethod=function(t){if(typeof t==="string"){return crypto.createHash(algorithm).update(t,"utf8").digest("hex")}else{if(t===null||t===undefined){throw new Error(ERROR)}else if(t.constructor===ArrayBuffer){t=new Uint8Array(t)}}if(Array.isArray(t)||ArrayBuffer.isView(t)||t.constructor===Buffer){return crypto.createHash(algorithm).update(new Buffer(t)).digest("hex")}else{return method(t)}};return nodeMethod};var createHmacOutputMethod=function(t,e){return function(n,i){return new HmacSha256(n,e,true).update(i)[t]()}};var createHmacMethod=function(t){var e=createHmacOutputMethod("hex",t);e.create=function(e){return new HmacSha256(e,t)};e.update=function(t,n){return e.create(t).update(n)};for(var n=0;n<OUTPUT_TYPES.length;++n){var i=OUTPUT_TYPES[n];e[i]=createHmacOutputMethod(i,t)}return e};function Sha256(t,e){if(e){blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0;this.blocks=blocks}else{this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}if(t){this.h0=3238371032;this.h1=914150663;this.h2=812702999;this.h3=4144912697;this.h4=4290775857;this.h5=1750603025;this.h6=1694076839;this.h7=3204075428}else{this.h0=1779033703;this.h1=3144134277;this.h2=1013904242;this.h3=2773480762;this.h4=1359893119;this.h5=2600822924;this.h6=528734635;this.h7=1541459225}this.block=this.start=this.bytes=this.hBytes=0;this.finalized=this.hashed=false;this.first=true;this.is224=t}Sha256.prototype.update=function(t){if(this.finalized){return}var e,n=typeof t;if(n!=="string"){if(n==="object"){if(t===null){throw new Error(ERROR)}else if(ARRAY_BUFFER&&t.constructor===ArrayBuffer){t=new Uint8Array(t)}else if(!Array.isArray(t)){if(!ARRAY_BUFFER||!ArrayBuffer.isView(t)){throw new Error(ERROR)}}}else{throw new Error(ERROR)}e=true}var i,r=0,s,o=t.length,a=this.blocks;while(r<o){if(this.hashed){this.hashed=false;a[0]=this.block;a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0}if(e){for(s=this.start;r<o&&s<64;++r){a[s>>2]|=t[r]<<SHIFT[s++&3]}}else{for(s=this.start;r<o&&s<64;++r){i=t.charCodeAt(r);if(i<128){a[s>>2]|=i<<SHIFT[s++&3]}else if(i<2048){a[s>>2]|=(192|i>>6)<<SHIFT[s++&3];a[s>>2]|=(128|i&63)<<SHIFT[s++&3]}else if(i<55296||i>=57344){a[s>>2]|=(224|i>>12)<<SHIFT[s++&3];a[s>>2]|=(128|i>>6&63)<<SHIFT[s++&3];a[s>>2]|=(128|i&63)<<SHIFT[s++&3]}else{i=65536+((i&1023)<<10|t.charCodeAt(++r)&1023);a[s>>2]|=(240|i>>18)<<SHIFT[s++&3];a[s>>2]|=(128|i>>12&63)<<SHIFT[s++&3];a[s>>2]|=(128|i>>6&63)<<SHIFT[s++&3];a[s>>2]|=(128|i&63)<<SHIFT[s++&3]}}}this.lastByteIndex=s;this.bytes+=s-this.start;if(s>=64){this.block=a[16];this.start=s-64;this.hash();this.hashed=true}else{this.start=s}}if(this.bytes>4294967295){this.hBytes+=this.bytes/4294967296<<0;this.bytes=this.bytes%4294967296}return this};Sha256.prototype.finalize=function(){if(this.finalized){return}this.finalized=true;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block;t[e>>2]|=EXTRA[e&3];this.block=t[16];if(e>=56){if(!this.hashed){this.hash()}t[0]=this.block;t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0}t[14]=this.hBytes<<3|this.bytes>>>29;t[15]=this.bytes<<3;this.hash()};Sha256.prototype.hash=function(){var t=this.h0,e=this.h1,n=this.h2,i=this.h3,r=this.h4,s=this.h5,o=this.h6,a=this.h7,c=this.blocks,l,u,h,d,f,p,y,w,g,m,_;for(l=16;l<64;++l){f=c[l-15];u=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3;f=c[l-2];h=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10;c[l]=c[l-16]+u+c[l-7]+h<<0}_=e&n;for(l=0;l<64;l+=4){if(this.first){if(this.is224){w=300032;f=c[0]-1413257819;a=f-150054599<<0;i=f+24177077<<0}else{w=704751109;f=c[0]-210244248;a=f-1521486534<<0;i=f+143694565<<0}this.first=false}else{u=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10);h=(r>>>6|r<<26)^(r>>>11|r<<21)^(r>>>25|r<<7);w=t&e;d=w^t&n^_;y=r&s^~r&o;f=a+h+y+K[l]+c[l];p=u+d;a=i+f<<0;i=f+p<<0}u=(i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10);h=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7);g=i&t;d=g^i&e^w;y=a&r^~a&s;f=o+h+y+K[l+1]+c[l+1];p=u+d;o=n+f<<0;n=f+p<<0;u=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10);h=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7);m=n&i;d=m^n&t^g;y=o&a^~o&r;f=s+h+y+K[l+2]+c[l+2];p=u+d;s=e+f<<0;e=f+p<<0;u=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10);h=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7);_=e&n;d=_^e&i^m;y=s&o^~s&a;f=r+h+y+K[l+3]+c[l+3];p=u+d;r=t+f<<0;t=f+p<<0}this.h0=this.h0+t<<0;this.h1=this.h1+e<<0;this.h2=this.h2+n<<0;this.h3=this.h3+i<<0;this.h4=this.h4+r<<0;this.h5=this.h5+s<<0;this.h6=this.h6+o<<0;this.h7=this.h7+a<<0};Sha256.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,i=this.h3,r=this.h4,s=this.h5,o=this.h6,a=this.h7;var c=HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[t&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[e&15]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[n&15]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[i&15]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[r&15]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[s&15]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[o&15];if(!this.is224){c+=HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[a&15]}return c};Sha256.prototype.toString=Sha256.prototype.hex;Sha256.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,i=this.h3,r=this.h4,s=this.h5,o=this.h6,a=this.h7;var c=[t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24&255,n>>16&255,n>>8&255,n&255,i>>24&255,i>>16&255,i>>8&255,i&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255,o>>24&255,o>>16&255,o>>8&255,o&255];if(!this.is224){c.push(a>>24&255,a>>16&255,a>>8&255,a&255)}return c};Sha256.prototype.array=Sha256.prototype.digest;Sha256.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(this.is224?28:32);var e=new DataView(t);e.setUint32(0,this.h0);e.setUint32(4,this.h1);e.setUint32(8,this.h2);e.setUint32(12,this.h3);e.setUint32(16,this.h4);e.setUint32(20,this.h5);e.setUint32(24,this.h6);if(!this.is224){e.setUint32(28,this.h7)}return t};function HmacSha256(t,e,n){var i,r=typeof t;if(r==="string"){var s=[],o=t.length,a=0,c;for(i=0;i<o;++i){c=t.charCodeAt(i);if(c<128){s[a++]=c}else if(c<2048){s[a++]=192|c>>6;s[a++]=128|c&63}else if(c<55296||c>=57344){s[a++]=224|c>>12;s[a++]=128|c>>6&63;s[a++]=128|c&63}else{c=65536+((c&1023)<<10|t.charCodeAt(++i)&1023);s[a++]=240|c>>18;s[a++]=128|c>>12&63;s[a++]=128|c>>6&63;s[a++]=128|c&63}}t=s}else{if(r==="object"){if(t===null){throw new Error(ERROR)}else if(ARRAY_BUFFER&&t.constructor===ArrayBuffer){t=new Uint8Array(t)}else if(!Array.isArray(t)){if(!ARRAY_BUFFER||!ArrayBuffer.isView(t)){throw new Error(ERROR)}}}else{throw new Error(ERROR)}}if(t.length>64){t=new Sha256(e,true).update(t).array()}var l=[],u=[];for(i=0;i<64;++i){var h=t[i]||0;l[i]=92^h;u[i]=54^h}Sha256.call(this,e,n);this.update(u);this.oKeyPad=l;this.inner=true;this.sharedMemory=n}HmacSha256.prototype=new Sha256;HmacSha256.prototype.finalize=function(){Sha256.prototype.finalize.call(this);if(this.inner){this.inner=false;var t=this.array();Sha256.call(this,this.is224,this.sharedMemory);this.update(this.oKeyPad);this.update(t);Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports;exports.sha224=createMethod(true);exports.sha256.hmac=createHmacMethod();exports.sha224.hmac=createHmacMethod(true);if(COMMON_JS){module.exports=exports}else{root.sha256=exports.sha256;root.sha224=exports.sha224}})()})(sha256);var getRandomValues;var rnds8=new Uint8Array(16);function rng(){if(!getRandomValues){getRandomValues=typeof crypto!=="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!=="undefined"&&typeof msCrypto.getRandomValues==="function"&&msCrypto.getRandomValues.bind(msCrypto);if(!getRandomValues){throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}}return getRandomValues(rnds8)}const REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(t){return typeof t==="string"&&REGEX.test(t)}var byteToHex=[];for(var i=0;i<256;++i){byteToHex.push((i+256).toString(16).substr(1))}function stringify(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=(byteToHex[t[e+0]]+byteToHex[t[e+1]]+byteToHex[t[e+2]]+byteToHex[t[e+3]]+"-"+byteToHex[t[e+4]]+byteToHex[t[e+5]]+"-"+byteToHex[t[e+6]]+byteToHex[t[e+7]]+"-"+byteToHex[t[e+8]]+byteToHex[t[e+9]]+"-"+byteToHex[t[e+10]]+byteToHex[t[e+11]]+byteToHex[t[e+12]]+byteToHex[t[e+13]]+byteToHex[t[e+14]]+byteToHex[t[e+15]]).toLowerCase();if(!validate(n)){throw TypeError("Stringified UUID is invalid")}return n}function v4(t,e,n){t=t||{};var i=t.random||(t.rng||rng)();i[6]=i[6]&15|64;i[8]=i[8]&63|128;if(e){n=n||0;for(var r=0;r<16;++r){e[n+r]=i[r]}return e}return stringify(i)}async function getBytes(t,e){const n=t.getReader();let i;while(!(i=await n.read()).done){e(i.value)}}function getLines(t){let e;let n;let i;let r=false;return function s(o){if(e===undefined){e=o;n=0;i=-1}else{e=concat(e,o)}const a=e.length;let c=0;while(n<a){if(r){if(e[n]===10){c=++n}r=false}let s=-1;for(;n<a&&s===-1;++n){switch(e[n]){case 58:if(i===-1){i=n-c}break;case 13:r=true;case 10:s=n;break}}if(s===-1){break}t(e.subarray(c,s),i);c=n;i=-1}if(c===a){e=undefined}else if(c!==0){e=e.subarray(c);n-=c}}}function getMessages(t,e,n){let i=newMessage();const r=new TextDecoder;return function s(o,a){if(o.length===0){n===null||n===void 0?void 0:n(i);i=newMessage()}else if(a>0){const n=r.decode(o.subarray(0,a));const s=a+(o[a+1]===32?2:1);const c=r.decode(o.subarray(s));switch(n){case"data":i.data=i.data?i.data+"\n"+c:c;break;case"event":i.event=c;break;case"id":t(i.id=c);break;case"retry":const n=parseInt(c,10);if(!isNaN(n)){e(i.retry=n)}break}}}}function concat(t,e){const n=new Uint8Array(t.length+e.length);n.set(t);n.set(e,t.length);return n}function newMessage(){return{data:"",event:"",id:"",retry:undefined}}var __rest=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};const EventStreamContentType="text/event-stream";const DefaultRetryInterval=1e3;const LastEventId="last-event-id";function fetchEventSource(t,e){var{signal:n,headers:i,onopen:r,onmessage:s,onclose:o,onerror:a,openWhenHidden:c,fetch:l}=e,u=__rest(e,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise(((e,h)=>{const d=Object.assign({},i);if(!d.accept){d.accept=EventStreamContentType}let f;function p(){f.abort();if(!document.hidden){b()}}if(!c){document.addEventListener("visibilitychange",p)}let y=DefaultRetryInterval;let w=0;function g(){document.removeEventListener("visibilitychange",p);window.clearTimeout(w);f.abort()}n===null||n===void 0?void 0:n.addEventListener("abort",(()=>{g();e()}));const m=l!==null&&l!==void 0?l:window.fetch;const _=r!==null&&r!==void 0?r:defaultOnOpen;async function b(){var n;f=new AbortController;try{const n=await m(t,Object.assign(Object.assign({},u),{headers:d,signal:f.signal}));await _(n);await getBytes(n.body,getLines(getMessages((t=>{if(t){d[LastEventId]=t}else{delete d[LastEventId]}}),(t=>{y=t}),s)));o===null||o===void 0?void 0:o();g();e()}catch(t){if(!f.signal.aborted){try{const e=(n=a===null||a===void 0?void 0:a(t))!==null&&n!==void 0?n:y;window.clearTimeout(w);w=window.setTimeout(b,e)}catch(t){g();h(t)}}}}b()}))}function defaultOnOpen(t){const e=t.headers.get("content-type");if(!(e===null||e===void 0?void 0:e.startsWith(EventStreamContentType))){throw new Error(`Expected content-type to be ${EventStreamContentType}, Actual: ${e}`)}}function Base64EncodeUrl(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function getTimestamp(){return Math.floor(Date.now()/1e3)}function e(t){this.message=t}e.prototype=new Error,e.prototype.name="InvalidCharacterError";var r$1="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(t){var n=String(t).replace(/=+$/,"");if(n.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,r,s=0,o=0,a="";r=n.charAt(o++);~r&&(i=s%4?64*i+r:r,s++%4)?a+=String.fromCharCode(255&i>>(-2*s&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};function t$1(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(r$1(t).replace(/(.)/g,(function(t,e){var n=e.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(e)}catch(t){return r$1(e)}}function n$1(t){this.message=t}function o(t,e){if("string"!=typeof t)throw new n$1("Invalid token specified");var n=!0===(e=e||{}).header?0:1;try{return JSON.parse(t$1(t.split(".")[n]))}catch(t){throw new n$1("Invalid token specified: "+t.message)}}n$1.prototype=new Error,n$1.prototype.name="InvalidTokenError";class NylasSessions{clientId;redirectUri;accessType="online";domain="http://api.nylas.com";versioned=false;Storage;hosted=false;multiAccount=false;loginId="";constructor(t){this.clientId=t.clientId;this.redirectUri=t.redirectUri;if(t.domain){this.domain=t.domain;const e=this.domain.substring(this.domain.length-3);if(e.includes("/v")){this.versioned=true}}if(t.multiAccount){this.multiAccount=t.multiAccount}if(t.sw){const t=new IndexedDBStorage;this.Storage=new Storage(t)}else{this.Storage=new Storage}if(t.accessType){this.accessType=t.accessType}if(t.loginId){this.loginId=t.loginId}if(t.hosted){this.hosted=t.hosted}this.codeExchange(null)}async validateAccessToken(t=""){const e=await this.Storage.getGrant(t,this.multiAccount);if(!e){return false}const{access_token:n}=e;try{const t=await fetch(`${this.domain}/connect/tokeninfo?access_token=${n}`,{method:"GET"});const e=await t.json();if(!e.data){return false}return true}catch(t){return false}}async validateIDToken(t=""){const e=await this.Storage.getGrant(t,this.multiAccount);if(!e){return false}const{id_token:n}=e;try{const t=await fetch(`${this.domain}/connect/tokeninfo?id_token=${n}`,{method:"GET"});if(t.status!==200){return false}const e=await t.json();if(!e.data){return false}return true}catch(t){return false}}getDomain(){return this.domain}async auth(t){if(this.hosted&&(this.domain===window.location.origin||this.versioned&&this.domain.includes(window.location.origin))){await this.hostedSetCodeChallenge()}const e=await this.generateAuthURL(t);if(t.popup){this.popUp(e);return}return e}async generateAuthURL(t){const e=await this.getCodeChallege();let n=`${this.domain}/connect/auth?client_id=${this.clientId}&redirect_uri=${this.redirectUri}&access_type=${this.accessType}&response_type=code`;if(e){n+=`&code_challenge=${e}&code_challenge_method=S256&options=rotate_refresh_token`}if(t.provider){n+=`&provider=${t.provider}`}if(t.loginHint){n+=`&login_hint=${t.loginHint}`;if(t.includeGrantScopes){n+=`&include_grant_scopes=${t.includeGrantScopes}`}}if(t.scope){n+=`&scope=${t.scope.join(" ")}`}if(t.prompt){n+=`&prompt=${t.prompt}`}if(t.metadata){n+=`&metadata=${t.metadata}`}if(t.state||this.loginId){n+=`&state=${this.loginId?this.loginId:t.state}`}return n}async generateReauthURL(t,e){if(!t){throw new Error("Grant ID is required")}const n=await this.Storage.getUserToken(t);const i=await this.getCodeChallege();let r=`${this.domain}/connect/auth?client_id=${this.clientId}&redirect_uri=${this.redirectUri}&access_type=${this.accessType}&response_type=code`;if(i){r+=`&code_challenge=${i}&code_challenge_method=S256&options=rotate_refresh_token`}if(n?.provider){r+=`&provider=${n.provider}`}if(n?.email){r+=`&login_hint=${n.email}`}if(e){r+=`&scope=${e.join(" ")}`}return r}async generateCodeChallenge(){const t=await this.Storage.getPKCE();if(t){return}const e=v4();this.Storage.setPKCE(e);return}async hostedSetCodeChallenge(){if(!this.hosted){throw console.error("Method only used with hosted flag enabled")}const t=new URLSearchParams(window.location.search);const e=t.get("code_challenge");if(!e){const t=await this.Storage.getPKCE();if(t){return}console.warn("Code challenge is recomended");return}this.Storage.setPKCE(e)}async getCodeChallege(){if(this.hosted&&(this.domain===window.location.origin||this.versioned&&this.domain.includes(window.location.origin))){const t=new URLSearchParams(window.location.search);const e=t.get("code_challenge");if(!e){console.warn("Code challenge is recomended");return""}return e}const t=await this.Storage.getPKCE();if(t){const e=sha256.exports.sha256(t);let n=Buffer.from(e).toString("base64");n=Base64EncodeUrl(n);return n}return""}async isLoggedIn(){if(this.hosted&&(this.domain===window.location.origin||this.versioned&&this.domain.includes(window.location.origin))){return false}const t=await this.Storage.getUserTokens();if(t&&t.length>0){if(this.multiAccount){await this.generateCodeChallenge()}return true}await this.generateCodeChallenge();return false}isMultiAccount(){return this.multiAccount}async logout(){const t=await this.getProfile();await this.Storage.clearSession();const e={detail:t};window.dispatchEvent(new CustomEvent("onLogoutSuccess",e))}async getProfile(t=""){let e;if(t){e=await this.Storage.getUserToken(t)}else{e=await this.Storage.getUserToken()}if(e){return e}return null}async getProfiles(){const t=await this.Storage.getUserTokens();if(t){return t}return null}async removeProfile(t){await this.Storage.removeUserToken(t);await this.Storage.removeGrant(t);return null}async authIMAP(t){const e=await this.getCodeChallege();const n={imap_username:t.username,imap_password:t.password,imap_host:t.hostIMAP,imap_port:t.portIMAP,type:t.type,smtp_host:t.hostSMTP,smtp_port:t.portSMTP,provider:t.provider,redirect_uri:this.redirectUri,state:t.state,public_application_id:this.clientId,access_type:this.accessType};if(this.loginId){n.id=this.loginId}if(e!=""){n.code_challenge=e;n.code_challenge_method="S256"}const i=await fetch(`${this.domain}/connect/login/imap`,{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify(n)});const r=await i.json();return r}async authEWS(t){const e=await this.getCodeChallege();const n={...t,redirect_uri:this.redirectUri,public_application_id:this.clientId,access_type:this.accessType};if(this.loginId){n.id=this.loginId}if(e!=""){n.code_challenge=e;n.code_challenge_method="S256"}const i=await fetch(`${this.domain}/connect/login/ews`,{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify(n)});const r=await i.json();return r}async detectEmail(t){const e=await fetch(`${this.versioned?this.domain:this.domain+"/connect"}/providers/detect?client_id=${this.clientId}&email=${t}`,{method:"POST",headers:new Headers({"content-type":"application/json"})});const n=await e.json();return n.data}async applicationInfo(){const t=await fetch(`${this.versioned?this.domain:this.domain+"/connect"}/applications?client_id=${this.clientId}`,{method:"GET",headers:new Headers({"content-type":"application/json"})});const e=await t.json();return e.data}async getAvailableProviders(){const t=await fetch(`${this.domain}/connect/providers/find?client_id=${this.clientId}`,{method:"GET",headers:new Headers({"content-type":"application/json"})});if(t){const e=await t.json();const n=e.data;return n}return null}onLoginSuccess(t){window.addEventListener("onLoginSuccess",(e=>t(e)))}onLogoutSuccess(t){window.addEventListener("onLogoutSuccess",(e=>t(e)))}onLoginFail(t){window.addEventListener("onLoginFail",(e=>t(e)))}onTokenRefreshSuccess(t){window.addEventListener("onTokenRefreshSuccess",(e=>t(e)))}onTokenRefreshFail(t){window.addEventListener("onTokenRefreshFail",(e=>t(e)))}onSessionExpired(t){window.addEventListener("onSessionExpired",(e=>t(e)))}async codeExchange(t){let e=new URLSearchParams(window.location.search);if(t){e=new URLSearchParams(t)}const n=e.get("code");const i=e.get("state");const r=e.get("error");const s=e.get("error_description");const o=e.get("error_code");if(r&&s&&o){const t={detail:{error:r,error_description:s,error_code:o}};window.dispatchEvent(new CustomEvent("onLoginFail",t));window.history.pushState({},document.title,window.location.pathname);return false}if(!n){console.warn("No code found");return false}if(window.opener&&window.name==="uas-popup"){console.warn("Popup window detected");return false}const a=await this.Storage.getPKCE();if(!a){console.warn("No code verifier found");return false}try{const t={client_id:this.clientId,redirect_uri:this.redirectUri,code:n,grant_type:"authorization_code",code_verifier:a};const e=await fetch(`${this.domain}/connect/token`,{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify(t)});const r=await e.json();if(r){if(r.error){const t={detail:r};window.dispatchEvent(new CustomEvent("onLoginFail",t));return true}const t=await this.handleCodeExchangeResponse(r);if(!t.valid){const e={detail:t.data};window.dispatchEvent(new CustomEvent("onLoginFail",e));return true}else{if(i){t.data.state=i}const e={detail:t.data};window.dispatchEvent(new CustomEvent("onLoginSuccess",e));window.history.pushState({},document.title,window.location.pathname)}}this.Storage.removePKCE();return true}catch(r){const t={detail:r};window.dispatchEvent(new CustomEvent("onLoginFail",t));window.history.pushState({},document.title,window.location.pathname);return false}}async tokenExchange(t=""){const e=await this.Storage.getGrant(t,this.multiAccount);if(!e){return false}const n=e.refresh_token;try{const e={client_id:this.clientId,redirect_uri:this.redirectUri,refresh_token:n,grant_type:"refresh_token"};const i=await fetch(`${this.domain}/connect/token`,{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify(e)});const r=await i.json();if(r){if(r.error){const t={detail:r};window.dispatchEvent(new CustomEvent("onTokenRefreshFail",t));return true}const e=getTimestamp();r.expires_in=e+r.expires_in;this.Storage.setGrant(r,this.multiAccount);const n=await this.validateIDToken(t);if(!n){const t={detail:r};window.dispatchEvent(new CustomEvent("onTokenRefreshFail",t));return true}const i={detail:r};window.dispatchEvent(new CustomEvent("onTokenRefreshSuccess",i));return true}this.Storage.removePKCE()}catch(t){const e={detail:t};window.dispatchEvent(new CustomEvent("onTokenRefreshFail",e));return false}}async handleCodeExchangeResponse(t){const e=true;if(t.error){return{data:t,valid:false}}const n=getTimestamp();t.expires_in=n+t.expires_in;this.Storage.setGrant(t,this.multiAccount);const i=o(t.id_token);i.status="authenticated";this.Storage.setUserToken(i);const r=await this.validateIDToken(i.sub);if(!r){return{data:t,valid:false}}return{data:t,valid:e}}async popUp(t){const e=500;const n=600;const i=window.screenX+(window.outerWidth-e)/2;const r=window.screenY+(window.outerHeight-n)/2.5;const s=`uas-popup`;const o=t;const a=window.open(o,s,`width=${e},height=${n},left=${i},top=${r}`);if(!a){return}const c=setInterval((async()=>{if(a.closed){const t={detail:{error_description:"OAuth provider window closed"}};window.dispatchEvent(new CustomEvent("onLoginFail",t));c&&clearInterval(c);return}try{const t=a.location.href.split("?");if(!t[0]){return}const e=a.location.search;a.history.pushState({},document.title,window.location.pathname);if(t[0]===this.redirectUri&&t.length>1){const t=await this.codeExchange(e);a.close();if(t){location.reload()}c&&clearInterval(c);return}}catch(t){return}}),1e3)}async getAccessToken(t=""){const e=getTimestamp();const n=await this.Storage.getGrant(t,this.multiAccount);if(!n){return null}const{access_token:i,expires_in:r}=n;const s=i;if(s){if(r&&r>getTimestamp()){const t=r-e;if(t>30){return s}}}await this.tokenExchange(t);const o=await this.Storage.getGrant(t,this.multiAccount);return o.access_token}async sse(t,e){const n=e.headers||{};const i=n["Grant-ID"];let r="";if(this.multiAccount){if(!i){this.logout();throw new Error("Grant ID is required for multi account calls")}r=await this.getAccessToken(i)}else{r=await this.getAccessToken()}delete n["Grant-ID"];n["Authorization"]=`Bearer ${r}`;if(!n["content-type"]){n["content-type"]="application/json"}return fetchEventSource(`${this.domain}/${t}`,{...e,headers:n})}async fetch(t,e,n=true,i){let r="";let s=1;if(this.multiAccount){if(!e.grant_id){this.logout();throw new Error("Grant ID is required for multi account calls")}const t=await this.getProfiles();s=t?t.length:1;r=await this.getAccessToken(e.grant_id)}else{r=await this.getAccessToken()}if(!r){throw new Error("Access token not found")}let o=e.headers;if(!Headers.prototype.isPrototypeOf(o)){o=new Headers({Authorization:`Bearer ${r}`,"content-type":"application/json"})}else{o.append("Authorization",`Bearer ${r}`);if(!o.has("content-type")){o.append("content-type","application/json")}}try{if(e?.body){e.body=JSON.stringify(e?.body)}const r=await fetch(`${i||this.domain}/${t}`,{...e,headers:o});if(!n){return r}const a=await(r?.json());const c=await this.isAuthenticatedResponse(r.status,a);if(!c){if(s>1){const t=await this.getProfile(e.grant_id);if(t){t.status="unauthorized";await this.Storage.setUserToken(t);const e={detail:{user:t}};window.dispatchEvent(new CustomEvent("onSessionExpired",e))}}else{const t=await this.Storage.getUserToken();const e={detail:{user:t}};window.dispatchEvent(new CustomEvent("onSessionExpired",e))}this.logout();return}return a}catch(t){throw t}}async fetchRequest(t,e,n,i=true,r,s){const o=await this.isLoggedIn();const a=new URL(t,r??this.domain);const c=new Headers;c.append("Accept","application/json");c.append("Content-Type","application/json");c.append("User-Agent","nylas-identity");if(o){const t=await this.getAccessToken();c.append("Authorization",`Bearer ${t}`)}const l=await fetch(a.toString(),{method:e||"GET",headers:c,mode:"cors",referrer:location.origin,body:n?JSON.stringify(n):undefined,...s||{}});if(!i){return l.body}const u=await l.json();return u}async isAuthenticatedResponse(t,e){if(t==401&&e?.error?.type=="token.unauthorized_access"){return false}return true}addAPIKey(t,e,n){this.Storage.setUserToken({aud:"https://api-staging.us.nylas.com/",exp:2e9,email_verified:true,iat:getTimestamp(),iss:"",email:e,provider:"virtual-calendar",status:"authenticated",name:e,sub:t});this.Storage.setGrant({grant_id:t,access_token:n,expires_in:2e9},this.multiAccount)}}var react_production_min={};
/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l=Symbol.for("react.element"),n=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),q=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z=Symbol.iterator;function A(t){if(null===t||"object"!==typeof t)return null;t=z&&t[z]||t["@@iterator"];return"function"===typeof t?t:null}var B={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,D={};function E(t,e,n){this.props=t;this.context=e;this.refs=D;this.updater=n||B}E.prototype.isReactComponent={};E.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};E.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function F(){}F.prototype=E.prototype;function G(t,e,n){this.props=t;this.context=e;this.refs=D;this.updater=n||B}var H=G.prototype=new F;H.constructor=G;C(H,E.prototype);H.isPureReactComponent=!0;var I=Array.isArray,J=Object.prototype.hasOwnProperty,K={current:null},L={key:!0,ref:!0,__self:!0,__source:!0};function M(t,e,n){var i,r={},s=null,o=null;if(null!=e)for(i in void 0!==e.ref&&(o=e.ref),void 0!==e.key&&(s=""+e.key),e)J.call(e,i)&&!L.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];r.children=c}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)void 0===r[i]&&(r[i]=a[i]);return{$$typeof:l,type:t,key:s,ref:o,props:r,_owner:K.current}}function N(t,e){return{$$typeof:l,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function O(t){return"object"===typeof t&&null!==t&&t.$$typeof===l}function escape(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,(function(t){return e[t]}))}var P=/\/+/g;function Q(t,e){return"object"===typeof t&&null!==t&&null!=t.key?escape(""+t.key):e.toString(36)}function R(t,e,i,r,s){var o=typeof t;if("undefined"===o||"boolean"===o)t=null;var a=!1;if(null===t)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case l:case n:a=!0}}if(a)return a=t,s=s(a),t=""===r?"."+Q(a,0):r,I(s)?(i="",null!=t&&(i=t.replace(P,"$&/")+"/"),R(s,e,i,"",(function(t){return t}))):null!=s&&(O(s)&&(s=N(s,i+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(P,"$&/")+"/")+t)),e.push(s)),1;a=0;r=""===r?".":r+":";if(I(t))for(var c=0;c<t.length;c++){o=t[c];var u=r+Q(o,c);a+=R(o,e,i,u,s)}else if(u=A(t),"function"===typeof u)for(t=u.call(t),c=0;!(o=t.next()).done;)o=o.value,u=r+Q(o,c++),a+=R(o,e,i,u,s);else if("object"===o)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function S(t,e,n){if(null==t)return t;var i=[],r=0;R(t,i,"","",(function(t){return e.call(n,t,r++)}));return i}function T(t){if(-1===t._status){var e=t._result;e=e();e.then((function(e){if(0===t._status||-1===t._status)t._status=1,t._result=e}),(function(e){if(0===t._status||-1===t._status)t._status=2,t._result=e}));-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var U={current:null},V={transition:null},W={ReactCurrentDispatcher:U,ReactCurrentBatchConfig:V,ReactCurrentOwner:K};react_production_min.Children={map:S,forEach:function(t,e,n){S(t,(function(){e.apply(this,arguments)}),n)},count:function(t){var e=0;S(t,(function(){e++}));return e},toArray:function(t){return S(t,(function(t){return t}))||[]},only:function(t){if(!O(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};react_production_min.Component=E;react_production_min.Fragment=p;react_production_min.Profiler=r;react_production_min.PureComponent=G;react_production_min.StrictMode=q;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W;react_production_min.cloneElement=function(t,e,n){if(null===t||void 0===t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=C({},t.props),r=t.key,s=t.ref,o=t._owner;if(null!=e){void 0!==e.ref&&(s=e.ref,o=K.current);void 0!==e.key&&(r=""+e.key);if(t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)J.call(e,c)&&!L.hasOwnProperty(c)&&(i[c]=void 0===e[c]&&void 0!==a?a[c]:e[c])}var c=arguments.length-2;if(1===c)i.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];i.children=a}return{$$typeof:l,type:t.type,key:r,ref:s,props:i,_owner:o}};react_production_min.createContext=function(e){e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null};e.Provider={$$typeof:t,_context:e};return e.Consumer=e};react_production_min.createElement=M;react_production_min.createFactory=function(t){var e=M.bind(null,t);e.type=t;return e};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(t){return{$$typeof:v,render:t}};react_production_min.isValidElement=O;react_production_min.lazy=function(t){return{$$typeof:y,_payload:{_status:-1,_result:t},_init:T}};react_production_min.memo=function(t,e){return{$$typeof:x,type:t,compare:void 0===e?null:e}};react_production_min.startTransition=function(t){var e=V.transition;V.transition={};try{t()}finally{V.transition=e}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(t,e){return U.current.useCallback(t,e)};react_production_min.useContext=function(t){return U.current.useContext(t)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(t){return U.current.useDeferredValue(t)};react_production_min.useEffect=function(t,e){return U.current.useEffect(t,e)};react_production_min.useId=function(){return U.current.useId()};react_production_min.useImperativeHandle=function(t,e,n){return U.current.useImperativeHandle(t,e,n)};react_production_min.useInsertionEffect=function(t,e){return U.current.useInsertionEffect(t,e)};react_production_min.useLayoutEffect=function(t,e){return U.current.useLayoutEffect(t,e)};react_production_min.useMemo=function(t,e){return U.current.useMemo(t,e)};react_production_min.useReducer=function(t,e,n){return U.current.useReducer(t,e,n)};react_production_min.useRef=function(t){return U.current.useRef(t)};react_production_min.useState=function(t){return U.current.useState(t)};react_production_min.useSyncExternalStore=function(t,e,n){return U.current.useSyncExternalStore(t,e,n)};react_production_min.useTransition=function(){return U.current.useTransition()};react_production_min.version="18.2.0";const LoginRequired=({authenticationUrl:t})=>h("div",{class:"login-required",part:"login-component"},h("div",{class:"card"},h("p",null,"Log into your account to use the Scheduler Editor."),h("button",{class:"google-button",onClick:async e=>{e.preventDefault();const n=await t("google");if(n){window.location.href=n}else{console.error(`[nylas-scheduler-editor] Unable to get authentication URL.`)}}},h("span",{class:"icon"},h("google-logo-icon",{width:"15",height:"15"})),"Continue with Google"),h("button",{class:"microsoft-button",onClick:async e=>{e.preventDefault();const n=await t("microsoft");if(n){window.location.href=n}else{console.error(`[nylas-scheduler-editor] Unable to get authentication URL.`)}}},h("span",{class:"icon"},h("microsoft-logo-icon",{width:"15",height:"15"})),"Continue with Microsoft"),h("button",{class:"other-provider-button",onClick:async e=>{e.preventDefault();const n=await t();if(n){window.location.href=n}else{console.error(`[nylas-scheduler-editor] Unable to get authentication URL.`)}}},"View all providers ",h("chevron-icon",{width:"17",height:"17"})),h("small",{class:"disclaimer-text"},"* You will be redirected to authenticate your account.")));function ExpressFlow({selectedConfiguration:t,currentUser:e,calendars:n}){const i=t?.participants?.find((t=>t.is_organizer))??e;const r=n?.find((t=>t.is_primary));return h(Fragment,null,h("nylas-event-info",null,h("div",{slot:"inputs"},h("nylas-event-title",null),h("nylas-event-duration",null),h("nylas-event-location",{userProvider:e.provider}))),h("nylas-booking-calendar-picker",{calendars:n,currentUser:e,defaultBookingCalendar:r?.id||i?.email}),h("nylas-scheduling-method",{exportparts:"nsm, nsm__header, nsm__input-label, nsm__dropdown, nsm__dropdown-button, nsm__dropdown-content"}),h("nylas-custom-event-slug",{name:"custom-event-slug",exportparts:"nces, nces__body, nces__header, nces__drawer-toggle--container, nces__input-textfield"}))}const nylasSchedulerEditorCss=':host{display:flex;flex-direction:column;overflow:visible;border-radius:var(--nylas-border-radius-2x);width:fit-content;background:var(--nylas-base-0);position:relative;box-shadow:0px 0px 6px -2px rgba(0, 0, 0, 0.05), 0px 5px 15px -3px rgba(0, 0, 0, 0.1);--nylas-primary:#2563eb;--nylas-error:#cc4841;--nylas-error-pressed:#992222;--nylas-wraning:#f06c00;--nylas-success:#16a392;--nylas-info:#2b8fc2;--nylas-base-0:#ffffff;--nylas-base-25:#fcfcfd;--nylas-base-50:#f8f9fc;--nylas-base-100:#eaecf5;--nylas-base-200:#d5d9eb;--nylas-base-300:#b3b8d8;--nylas-base-400:#717bbc;--nylas-base-500:#4e5ba6;--nylas-base-600:#3e4784;--nylas-base-700:#263f72;--nylas-base-800:#293056;--nylas-base-900:#101323;--nylas-base-950:#0e101b;--nylas-border-radius:0.25rem;--nylas-border-radius-2x:0.5rem;--nylas-border-radius-3x:0.75rem;--nylas-font-family:"Inter", sans-serif}@media screen and (max-width: 768px){:host{width:-moz-available;width:-webkit-fill-available;width:fill-available;min-width:325px}}div.scheduler-editor-content{height:610px}@media screen and (max-width: 768px){div.scheduler-editor-content{height:auto}}div.scheduler-editor-header{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid var(--nylas-base-200);color:var(--nylas-base-900)}div.scheduler-editor-header h1.scheduler-editor-title{display:flex;align-items:center;gap:0.5rem;width:858px;margin:0;font-size:18px;line-height:24px;font-weight:600}@media screen and (max-width: 768px){div.scheduler-editor-header h1.scheduler-editor-title{width:auto;min-width:calc(325px - 1rem)}}div.scheduler-editor-header button{background:transparent;border:none;cursor:pointer}div.scheduler-editor-header button:hover,div.scheduler-editor-header button:active{color:var(--nylas-primary)}div.scheduler-editor-header button:disabled{cursor:not-allowed}nylas-editor-tabs{width:auto;height:inherit}nylas-editor-tabs .composable{height:inherit;overflow:auto}nylas-editor-tabs nylas-event-info div[slot=inputs],nylas-editor-tabs nylas-event-limits div[slot=inputs]{display:flex;flex-direction:column;gap:1rem}.card{display:flex;flex-direction:column;padding:2rem;background-color:var(--nylas-base-0);border:1px solid var(--nylas-base-200);border-radius:5px;max-width:fit-content;align-self:center}.login-required{height:inherit;overflow-y:auto;display:flex;flex-direction:column;justify-content:center;padding:2rem 1rem;background-color:var(--nylas-base-25);border-radius:var(--nylas-border-radius-2x)}@media screen and (max-width: 768px){.login-required{height:auto}}.login-required p{margin:0 0 1rem}.login-required .microsoft-button,.login-required .google-button{height:48px;border:1px solid var(--nylas-base-300);border-radius:var(--nylas-border-radius-2x);font-size:1rem;line-height:24px;padding:0 1rem;background-color:var(--nylas-base-0);font-weight:600;cursor:pointer;display:flex;margin-bottom:1rem;background-color:var(--nylas-base-0);border:1px solid var(--nylas-base-200);border-radius:5px;justify-content:center;gap:0.5rem;align-items:center}.login-required .microsoft-button:hover,.login-required .google-button:hover{background-color:var(--nylas-base-25)}.login-required .microsoft-button:hover,.login-required .google-button:hover{background-color:var(--nylas-base-25)}.login-required .other-provider-button{height:48px;border:1px solid var(--nylas-base-300);border-radius:var(--nylas-border-radius-2x);font-size:1rem;line-height:24px;padding:0 1rem;background-color:var(--nylas-base-0);font-weight:600;cursor:pointer;display:flex;border:0;background-color:var(--nylas-base-0);height:48px;margin-bottom:1rem;font-size:0.95rem;justify-content:center;gap:0.25rem;align-items:center}.login-required .other-provider-button:hover{background-color:var(--nylas-base-25)}.login-required .other-provider-button svg{transform:rotate(180deg)}.login-required .other-provider-button:hover{background-color:var(--nylas-base-25)}.login-required .disclaimer-text{font-size:0.75rem;color:var(--nylas-base-600);align-self:center}.list-configurations{padding:2rem;height:inherit;background:var(--nylas-base-25);border-radius:var(--nylas-border-radius-2x)}@media screen and (max-width: 768px){.list-configurations{height:auto;padding:2rem 1rem}}.list-configurations nylas-list-configurations{height:inherit;display:flex;flex-direction:column}';const NylasSchedulerEditorStyle0=nylasSchedulerEditorCss;const NylasSchedulerEditor=class{constructor(t){registerInstance(this,t);this.init=createEvent(this,"init",7);this.loggedIn=createEvent(this,"loggedIn",7);this.loggedOut=createEvent(this,"loggedOut",7);this.schedulerConfigCloseClicked=createEvent(this,"schedulerConfigCloseClicked",7);this.handleSchedulerConfigCloseClicked=t=>{const e=this.schedulerConfigCloseClicked.emit(this.host);if("schedulerConfigCloseClicked"in this.eventOverrides){this.eventOverrides.schedulerConfigCloseClicked(e,this.nylasSchedulerConfigConnector)}if(!e.defaultPrevented){localStorage.removeItem("grant");localStorage.removeItem("user");window.location.reload()}};this.authenticationUrl=async t=>{if(!this.nylasApiRequest){console.error(`[nylas-scheduler-editor] Nylas API Request is not initialized.`);return""}const e=await this.nylasApiRequest.authenticationUrl({provider:t});return e||""};this.configurationId=undefined;this.nylasApiRequest=undefined;this.nylasSessionsConfig=undefined;this.defaultAuthArgs=undefined;this.eventOverrides={};this.schedulerPreviewLink="";this.defaultSchedulerConfigState=undefined;this.mode="app";this.additionalParticipants=undefined;this.hideEditorTabs=[];this.conferenceProviders=undefined;this.requiresSlug=false;this.automaticComponentRegistration=true}connectedCallback(){debug(`[nylas-scheduler-editor] connectedCallback`)}async componentWillLoad(){debug(`[nylas-scheduler-editor] componentWillLoad`);const t=this.additionalParticipants?.filter((t=>{const e=t.calendars?.length>0?t.calendars.filter((t=>t.id&&t.name)):[];if(t.name&&t.email&&e.length>0){return{name:t.name,email:t.email,calendars:e}}}));this.stores={schedulerConfig:CreateNylasSchedulerConfigStore({...this.defaultSchedulerConfigState,additionalParticipants:t,conferenceProviders:this.conferenceProviders,hideEditorTabs:this.hideEditorTabs,requiresSlug:this.requiresSlug})};if(!this.nylasApiRequest&&this.nylasSessionsConfig){const t=new NylasSessions(this.nylasSessionsConfig);await t.isLoggedIn();t.onLoginSuccess((async()=>{const t=await(this.nylasSchedulerConfigConnector?.schedulerConfig?.currentUser());if(t){const e=this.loggedIn.emit(this.host);if("loggedIn"in this.eventOverrides){await this.eventOverrides.loggedIn(e,this.nylasSchedulerConfigConnector)}if(!e.defaultPrevented){await this.loggedInHandler(t)}}}));t.onLoginFail((async()=>{this.stores?.schedulerConfig?.set("currentUser",null);const t=this.loggedOut.emit(this.host);if("loggedOut"in this.eventOverrides){await this.eventOverrides.loggedOut(t,this.nylasSchedulerConfigConnector);if(t.defaultPrevented){return}}}));this.nylasApiRequest=new NylasIdentityRequestWrapper(t)}if(this.nylasApiRequest&&this.defaultAuthArgs){this.nylasApiRequest.setDefaultAuthArgs(this.defaultAuthArgs)}this.baseProvider=new NylasBaseProvider(this.host,this.stores,this.automaticComponentRegistration,this.eventOverrides);const e=this.baseProvider.getStore("schedulerConfig");this.nylasSchedulerConfigConnector=new NylasSchedulerConfigConnector({nylasApiRequest:this.nylasApiRequest,nylasSchedulerConfigStore:e});const n=this.init.emit(this.host);if("init"in this.eventOverrides){await this.eventOverrides.init(n,this.nylasSchedulerConfigConnector)}if(!n.defaultPrevented){const t=await(this.nylasSchedulerConfigConnector?.schedulerConfig?.currentUser());if(t){const e=this.loggedIn.emit(this.host);if("loggedIn"in this.eventOverrides){await this.eventOverrides.loggedIn(e,this.nylasSchedulerConfigConnector)}if(!e.defaultPrevented){await this.loggedInHandler(t)}}else{this.stores?.schedulerConfig?.set("currentUser",null);const t=this.loggedOut.emit(this.host);if("loggedOut"in this.eventOverrides){await this.eventOverrides.loggedOut(t,this.nylasSchedulerConfigConnector);if(t.defaultPrevented){return}}}}this.stores?.schedulerConfig?.onChange("selectedConfiguration",(async t=>{if(t&&t.id){this.configurationId=t.id}}));this.baseProvider?.componentWillLoad(this.nylasSchedulerConfigConnector)}async componentDidLoad(){debug(`[nylas-scheduler-editor] componentDidLoad`);await(this.baseProvider?.componentDidLoad())}async componentDisconnected(){await(this.baseProvider?.componentDisconnected())}async configurationIdChanged(t){if(t){await(this.nylasSchedulerConfigConnector?.schedulerConfig?.getConfigurationById(t));this.stores?.schedulerConfig?.set("action","edit")}else{this.stores?.schedulerConfig?.set("selectedConfiguration",{});this.stores?.schedulerConfig?.set("action",null)}}async store(){return this.stores?.schedulerConfig}async schedulerConnector(){return this.nylasSchedulerConfigConnector}async registerComponentHandler(t){this.baseProvider?.registerComponent(t.detail)}async unregisterComponentHandler(t){this.baseProvider?.unregisterComponent(t.detail)}async loggedInHandler(t){this.stores?.schedulerConfig?.set("currentUser",t);if(!this.nylasSchedulerConfigConnector){return}await(this.nylasSchedulerConfigConnector.schedulerConfig?.getCalendars());if(this.configurationId){const t=await(this.nylasSchedulerConfigConnector.schedulerConfig?.getConfigurationById(this.configurationId));if(t&&t[0]?.id){this.stores?.schedulerConfig?.set("action","edit")}}}render(){const t=this.host.querySelector('[slot="custom-page-style-inputs"]');const e=this.stores?.schedulerConfig?.state.selectedConfiguration?.id;return h(Host,{key:"e3716df4b6320311046af1b529ee494c9b16c782"},h("div",{key:"1e33292840f2906cfe0f0d4519192851e18d0ce7",class:"scheduler-editor-header",part:"nse__header"},h("h1",{key:"830100ac6a1f5c369a6e665f4fe2ea458bf5b44f",class:"scheduler-editor-title",part:"nse__title"},h("calendar-icon",{key:"b69dafa07a0af6fae4e1f57be7c98221bc8fc237",width:"18",height:"18"}),"Scheduler Editor"),h("button",{key:"c2e4c17d62f67c8c4011a8f41357481bd17eb883",class:"scheduler-editor-close",title:"logout",onClick:t=>this.handleSchedulerConfigCloseClicked(t),part:"nse__close-button"},h("close-icon",{key:"74eb653f9b8fea4a7c3669f7a707a5ebaa18d8d1",width:"18",height:"18"}))),h("div",{key:"33273e52377ec5b88672ed66db2a43ceab01b583",class:"scheduler-editor-content",part:"nse__content"},this.stores?.schedulerConfig?.state.currentUser&&this.stores.schedulerConfig.state.action===null&&h("div",{class:"list-configurations"},h("nylas-list-configurations",{exportparts:"nlc__create-new-cta"})),this.stores?.schedulerConfig?.state.currentUser&&this.stores.schedulerConfig.state.action==="create"&&h("nylas-editor-tabs",{mode:"composable"},h(ExpressFlow,{currentUser:this.stores?.schedulerConfig?.state.currentUser,calendars:this.stores?.schedulerConfig?.state?.calendars,selectedConfiguration:this.stores?.schedulerConfig?.state?.selectedConfiguration})),this.stores?.schedulerConfig?.state.currentUser&&this.stores.schedulerConfig.state.action==="edit"&&h("nylas-editor-tabs",{key:e,mode:this.mode},this.mode==="composable"&&h("slot",null),this.mode==="app"&&t&&h("div",{style:{display:"none"},slot:"custom-page-style-inputs",key:e},h("slot",{name:"custom-page-style-inputs"}))),!this.stores?.schedulerConfig?.state.currentUser&&h("slot",{name:"login-required"},h(LoginRequired,{authenticationUrl:this.authenticationUrl}))))}get host(){return getElement(this)}static get watchers(){return{configurationId:["configurationIdChanged"]}}};NylasSchedulerEditor.style=NylasSchedulerEditorStyle0;export{NylasSchedulerEditor as nylas_scheduler_editor};
//# sourceMappingURL=p-795ebe60.entry.js.map